(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{821:function(e,t,n){"use strict";n.r(t),function(e,t){var a=n(20),r=n(21),l=n(390),s=function(){function t(){Object(a.a)(this,t);this.client=new l({tracker:{rtcConfig:{iceServers:[{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun.btbresource.com:3478"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]}},dht:!1}),this.torrentCallback=null,this.onStartCallback=null}return Object(r.a)(t,[{key:"init",value:function(e,t,n){this.torrentCallback=e,this.onStartCallback=t;var a=n;a||(a=document.querySelector("input[name=upload]")),a&&this.uploadElement(a,this.onStartCallback,function(e,t){if(e)return e;t=t.map(function(e){return e.file}),this.onFiles(t)}.bind(this))}},{key:"isTorrentFile",value:function(e){return-1!==e.name.indexOf(".torrent")}},{key:"isNotTorrentFile",value:function(e){return!this.isTorrentFile(e)}},{key:"onSeedTorrent",value:function(e){e.on("warning",function(e){console.log(e)}),e.on("error",function(e){console.log(e)}),this.torrentCallback(e)}},{key:"seedContent",value:function(t,n){var a=e.from(t),r=this.client.seed(a,n);r.on("infoHash",function(e){n(r)})}},{key:"seed",value:function(e){var t=this;0!==e.length&&(this.onStartCallback(e),setTimeout(function(){var n=t.client.seed(e,t.onSeedTorrent.bind(t));n.on("infoHash",function(e){t.torrentCallback(n)})},1e3))}},{key:"onFiles",value:function(e){console.log("got files:"),e.forEach(function(e){}),this.seed(e)}},{key:"uploadElement",value:function(e,t,n,a){"function"===typeof n&&(a=n,n={}),"string"===typeof n&&(n={type:n}),e.addEventListener("change",function(r){if(0===e.files.length)return a(null,[]);t&&t(null);var l=new FileReader,s=0,i=[];function o(t){var a=e.files[t];"text"===n.type?l.readAsText(a):"url"===n.type?l.readAsDataURL(a):l.readAsArrayBuffer(a)}l.addEventListener("load",function(t){i.push({file:e.files[s],target:t.target}),++s===e.files.length?a(null,i):o(s)}),o(s)})}}]),t}();t.exports=s}.call(this,n(8).Buffer,n(823)(e))},992:function(e,t,n){"use strict";n.r(t);var a=n(49),r=n(20),l=n(21),s=n(23),i=n(22),o=n(24),c=n(0),u=n.n(c),h=n(804),m=n(805),d=n(224),p=n(225),f=n(227),g=n(30),v=n(63),E=n(85),k=n(62),b=n(74),y=n(121),S=n(51),O=n(226),F=n(75),T=n(811),C=n(974),N=n(975),j=n(810),I=n(389),w=n(384),M=n(385),B=n(13),L=(n(27),n(892)),H=n(821),A=n(13),x=A.postSafe,R=A.loadLocalAccount,P=A.signString,D=function(e){function t(e){var n;Object(r.a)(this,t);return(n=Object(s.a)(this,Object(i.a)(t).call(this,e))).state={collapse:!0,resourceList:[],resource:{tags:"",price:"",fee:"",deadline:"",owner:"",id:""},rsId:""},n.state.shareMsg="",n.share=new H,n.userSec="",n.fee=.01,n.deadline=5,n.price=0,n.tags="",n.resName="",n.resId="",n.infoInterval=null,n.torrentList=[],n.resume=null,n.html5File=null,n.torrent=null,n.poster=null,n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"cancelShare",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"toggle",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"uploadTorrent",value:function(){var e=this,t=this.torrent,n=t.torrentFile.toString("base64"),a=t.infoHash,r=this.poster,l=this.torrent.files[0].name;this.setState({shareMsg:"\u6587\u4ef6\u4e0a\u4f20\u4e2d..."}),console.log("upload torrentFile"+n);var s={torrentFile:n,infoHash:a,poster:r,name:l},i=(new Date).getTime();i-=i%864e5;var o=P(this.userSec,a+i),c=Object(B.getFileHost)();x({url:c+"/torrentFile/"+a+"/"+o,nonce:"0000"},s,function(t){t&&(e.initResumable(a,o),e.resume.addFile(e.html5File))})}},{key:"componentDidMount",value:function(){var e=R();e&&e.secret&&(this.userSec=e.secret,this.setState({rsId:e.rsId})),this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this))}},{key:"initResumable",value:function(e,t){var n=this,a=Object(B.getFileHost)()+"/share/"+e+"/"+t;this.resume=new L({target:a,chunkSize:1048576,simultaneousUploads:4,testChunks:!1,throttleProgressCallbacks:1,method:"octet"}),this.resume.on("fileAdded",function(e){console.log("resume got file "+e),n.resume?n.resume.upload():console.log("this.resume is null")}.bind(this)),this.resume.on("pause",function(){console.log("resume pause")}),this.resume.on("complete",function(){console.log("resume complete"),n.setState({shareMsg:"\u6587\u4ef6\u4e0a\u4f20\u6210\u529f"})}),this.resume.on("fileSuccess",function(e,t){console.log("resume fileSuccess")}),this.resume.on("fileError",function(e,t){console.log("resume fileError"),n.setState({shareMsg:"\u53d1\u5e03\u8d44\u6e90\u51fa\u9519\u4e86",uploadAgain:!0})}),this.resume.on("fileProgress",function(e){var t=100*e.progress();n.setState({shareMsg:"\u6587\u4ef6\u4e0a\u4f20\u4e2d "+t+"%"})}),this.resume.on("cancel",function(){console.log("resume cancel")}),this.resume.on("uploadStart",function(){console.log("resume uploadStart")})}},{key:"prettyBytes",value:function(e){var t,n=e<0,a=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return n&&(e=-e),e<1?(n?"-":"")+e+" B":(t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),a.length-1),(n?"-":"")+(e=Number((e/Math.pow(1e3,t)).toFixed(2)))+" "+a[t])}},{key:"updateTorrentStatus",value:function(){var e=this;this.torrentList.map(function(t){var n=document.querySelector("#pid"+t.infoHash);n&&(n.innerHTML=t.numPeers);var a=document.querySelector("#sid"+t.infoHash);a&&(a.innerHTML=e.prettyBytes(t.uploadSpeed)+"/s")})}},{key:"onTorrentStart",value:function(e){this.setState({shareMsg:"\u5904\u7406\u4e2d...(\u5927\u6587\u4ef6\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162,\u8bf7\u8010\u5fc3\u7b49\u5f85)"}),e&&(this.html5File=e[0])}},{key:"onTorrentDone",value:function(e){if(this.setState({ready:!0}),e){this.torrent=e;e.infoHash,e.magnetURI,e.torrentFileBlobURL,e.name;this.resId=e.infoHash,this.resName=e.name;var t=this.state.resourceList;t.push({id:this.resId,name:this.resName}),this.setState({resourceList:t}),e.key=e.infoHash,this.torrentList.unshift(e)}this.infoInterval||(this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3e3)),this.setState({shareMsg:""})}},{key:"updateSecret",value:function(e){if(e&&e.target){this.userSec=e.target.value;var t=Object(B.calcAccountId)(this.userSec);this.setState({rsId:t})}}},{key:"updateFee",value:function(e){e&&e.target&&(this.fee=e.target.value)}},{key:"updatePrice",value:function(e){e&&e.target&&(this.price=e.target.value)}},{key:"updateTags",value:function(e){e&&e.target&&(this.tags=e.target.value)}},{key:"updateDeadline",value:function(e){e&&e.target&&(this.deadline=e.target.value)}},{key:"renderAddFile",value:function(){return u.a.createElement(h.a,null,u.a.createElement(m.a,{xs:"12"},u.a.createElement(S.a,null,u.a.createElement(d.a,null,u.a.createElement(p.a,null,u.a.createElement("i",{className:"icon-share",onClick:this.toggle.bind(this)},"\u6d41\u91cf\u77ff\u5de5\u8d5a\u79ef\u5206"),u.a.createElement("div",{className:"card-header-actions"},u.a.createElement(g.a,{color:"link",className:"card-header-action btn-setting"},u.a.createElement("i",{className:"icon-settings"})),u.a.createElement(g.a,{color:"link",className:"card-header-action btn-minimize","data-target":"#collapseExample",onClick:this.toggle.bind(this)},u.a.createElement("i",{className:"icon-arrow-up"})),u.a.createElement(g.a,{color:"link",className:"card-header-action btn-close",onClick:this.toggleFade},u.a.createElement("i",{className:"icon-close"})))),u.a.createElement(O.a,{isOpen:this.state.collapse,id:"collapseExample"},u.a.createElement(f.a,null,u.a.createElement(F.a,null,u.a.createElement("div",{className:"controls"},u.a.createElement(v.a,{className:"input-prepend"},u.a.createElement(E.a,{addonType:"prepend"},u.a.createElement(k.a,null,"\u6211\u7684\u8d26\u53f7:")),u.a.createElement(b.a,{id:"prependedInput",size:"16",type:"text",value:this.state.rsId})))),u.a.createElement(F.a,null,u.a.createElement("div",{className:"controls"},u.a.createElement(v.a,{className:"input-prepend"},u.a.createElement(E.a,{addonType:"prepend"},u.a.createElement(k.a,null,"\u672c\u5730\u8d44\u6e90:")),u.a.createElement("input",{name:"upload",type:"file"}))))))))))}},{key:"renderUploadAgainButton",value:function(){var e=this;return this.state.uploadAgain?u.a.createElement(g.a,{type:"submit",color:"primary",onClick:function(t){return e.uploadAgain()}},"\u91cd\u65b0\u4e0a\u4f20"):null}},{key:"renderResourceItems",value:function(){return this.state.resourceList.map(function(e){var t="pid"+e.id,n="sid"+e.id;return u.a.createElement(T.a,{action:!0},u.a.createElement(C.a,null,e.name,"   ",u.a.createElement(U,{id:e.id,res:e})),u.a.createElement(N.a,null,u.a.createElement("code",null," ",u.a.createElement("span",{id:t}),"\u8282\u70b9"),". \u2197",u.a.createElement("code",null,u.a.createElement("span",{id:n}),"\u4e0a\u4f20\u901f\u5ea6")," ",u.a.createElement("code",null,u.a.createElement("span",{id:n},0),"\u4e2a\u786e\u8ba4\u4fe1\u606f")))})}},{key:"renderShareList",value:function(){return u.a.createElement(h.a,null,u.a.createElement(m.a,{sm:"12",xl:"6"},u.a.createElement(d.a,null,u.a.createElement(p.a,null,u.a.createElement("i",{className:"fa fa-align-justify"}),u.a.createElement("strong",null,"\u8d44\u6e90\u5217\u8868"),u.a.createElement(y.a,{color:"danger"},u.a.createElement("small",null,"\u6d41\u91cf\u77ff\u5de5\u901a\u8fc7\u5206\u4eab\u672c\u673a\u786c\u76d8\u4e0e\u7f51\u7edc\u6d41\u91cf\u4e3a\u5176\u4ed6\u7528\u6237\u63d0\u4f9b\u8d44\u6e90\u4e0b\u8f7d\u670d\u52a1\u3002\u5176\u4ed6\u7528\u6237\u6210\u529f\u4e0b\u8f7d\u8d44\u6e90\u540e\u4f1a\u7559\u4e0b\u786e\u8ba4\u4fe1\u606f\uff0c\u6d41\u91cf\u77ff\u5de5\u7528\u6536\u96c6\u5230\u7684\u786e\u8ba4\u4fe1\u606f\u6362\u53d6\u771e\u5ba2\u79ef\u5206\u3002\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u5173\u95ed\u6b64\u9875\u9762\uff0c\u4fdd\u6301\u6b64\u9875\u9762\u6253\u5f00\u72b6\u6001\u4e0b\uff0c\u7f51\u7edc\u4e0a\u5176\u4ed6\u7528\u6237\u624d\u53ef\u4ee5\u4e0b\u8f7d\u8d44\u6e90"))),u.a.createElement(f.a,null,u.a.createElement(j.a,null,this.renderResourceItems())))))}},{key:"render",value:function(){return u.a.createElement("div",{className:"animated fadeIn"},this.renderAddFile(),u.a.createElement("div",null,u.a.createElement(y.a,{color:"info"},this.state.shareMsg)),this.renderShareList())}}]),t}(c.Component),U=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(i.a)(t).call(this,e))).toggle=n.toggle.bind(Object(a.a)(Object(a.a)(n))),n.state={popoverOpen:!1},n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({popoverOpen:!this.state.popoverOpen})}},{key:"render",value:function(){return u.a.createElement("span",null,u.a.createElement("span",{className:"alert-primary  fade show",id:"Popover-"+this.props.id,onClick:this.toggle},"(\u5206\u4eab\u94fe\u63a5)"),u.a.createElement(I.a,{placement:"top",isOpen:this.state.popoverOpen,target:"Popover-"+this.props.id,toggle:this.toggle},u.a.createElement(w.a,null,"\u5206\u4eab\u8fd9\u4e2a\u8d44\u6e90\u7684\u94fe\u63a5,\u83b7\u53d6\u66f4\u591a\u786e\u8ba4\u4fe1\u606f"),u.a.createElement(M.a,null,Object(B.getCurrentHost)()+"/#/btb#"+this.props.res.id+"#"+this.props.res.name)))}}]),t}(c.Component);t.default=D}}]);
//# sourceMappingURL=19.27f393d8.chunk.js.map