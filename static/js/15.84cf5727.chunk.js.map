{"version":3,"sources":["views/ggv/js/share.js","views/ggv/WebMiner/WebMiner.js"],"names":["ZkerPlayer","require","ShareManager","Object","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","player","torrentCallback","onStartCallback","uploadInput","up","document","querySelector","uploadElement","err","files","map","file","onFiles","bind","name","indexOf","isTorrentFile","torrent","on","warn","console","log","content","buf","Buffer","from","tor","seed","infoHash","_this","length","setTimeout","onSeedTorrent","forEach","elem","opts","cb","type","addEventListener","ev","reader","FileReader","index","results","read","readAsText","readAsDataURL","readAsArrayBuffer","e","push","target","Resumable","default","loadLocalAccount","postSafe","WebMiner","signString","props","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","state","collapse","resourceList","resource","tags","price","fee","deadline","owner","id","rsId","shareMsg","share","userSec","resName","resId","infoInterval","torrentList","resume","html5File","poster","tokenCount","Map","setState","account","secret","init","onTorrentDone","onTorrentStart","signature","_this2","getFileHost","chunkSize","simultaneousUploads","testChunks","throttleProgressCallbacks","method","upload","message","uploadAgain","p","progress","num","exponent","neg","units","Math","min","floor","Number","pow","toFixed","_this3","peersSpan","innerHTML","numPeers","speedSpan","prettyBytes","uploadSpeed","tokenSpan","rtokens","html5Files","_this4","downloadId","download","loadMinerResource","ok","resources","r","rtoken","lastKey","localStorage","getItem","setItem","newKey","Date","getTime","has","count","get","set","_this5","config","resourceTokenCallBack","handleResourceToken","rlist","unshift","ready","magnetURI","torrentFileBlobURL","key","setInterval","updateTorrentStatus","value","_this6","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","reactstrap__WEBPACK_IMPORTED_MODULE_7__","reactstrap__WEBPACK_IMPORTED_MODULE_8__","xs","reactstrap__WEBPACK_IMPORTED_MODULE_18__","reactstrap__WEBPACK_IMPORTED_MODULE_9__","reactstrap__WEBPACK_IMPORTED_MODULE_10__","className","onClick","toggle","reactstrap__WEBPACK_IMPORTED_MODULE_12__","color","data-target","toggleFade","reactstrap__WEBPACK_IMPORTED_MODULE_19__","isOpen","reactstrap__WEBPACK_IMPORTED_MODULE_11__","reactstrap__WEBPACK_IMPORTED_MODULE_20__","reactstrap__WEBPACK_IMPORTED_MODULE_13__","reactstrap__WEBPACK_IMPORTED_MODULE_14__","addonType","reactstrap__WEBPACK_IMPORTED_MODULE_15__","reactstrap__WEBPACK_IMPORTED_MODULE_16__","size","onChange","updateDownloadId","placeholder","addServerResoruce","_this7","res","pid","sid","rid","reactstrap__WEBPACK_IMPORTED_MODULE_21__","action","reactstrap__WEBPACK_IMPORTED_MODULE_22__","PopoverItem","reactstrap__WEBPACK_IMPORTED_MODULE_23__","sm","xl","reactstrap__WEBPACK_IMPORTED_MODULE_17__","reactstrap__WEBPACK_IMPORTED_MODULE_24__","renderResourceItems","renderAddFile","renderShareList","Component","_this8","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_0__","popoverOpen","reactstrap__WEBPACK_IMPORTED_MODULE_25__","placement","reactstrap__WEBPACK_IMPORTED_MODULE_26__","reactstrap__WEBPACK_IMPORTED_MODULE_27__","getCurrentHost"],"mappings":"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","file":"static/js/15.84cf5727.chunk.js","sourcesContent":["const ZkerPlayer = require('zker-player')\r\n\r\nexport default class ShareManager {\r\n\r\n    constructor() {\r\n        this.player = new ZkerPlayer('', {})\r\n        this.torrentCallback = null\r\n        this.onStartCallback = null\r\n    }\r\n\r\n    init(torrentCallback, onStartCallback, uploadInput) {\r\n        this.torrentCallback = torrentCallback;\r\n        this.onStartCallback = onStartCallback;\r\n        var up = uploadInput;\r\n        if (!up)\r\n            up = document.querySelector('input[name=upload]')\r\n        if (up) {\r\n            this.uploadElement(up, this.onStartCallback, (function (err, files) {\r\n                if (err) return err;\r\n                files = files.map(function (file) { return file.file })\r\n                this.onFiles(files)\r\n            }).bind(this))\r\n        }\r\n    }\r\n\r\n    isTorrentFile(file) {\r\n        //var extname = path.extname(file.name).toLowerCase()\r\n        return file.name.indexOf('.torrent') !== -1;\r\n    }\r\n\r\n    isNotTorrentFile(file) {\r\n        return !this.isTorrentFile(file)\r\n    }\r\n\r\n    onSeedTorrent(torrent) {\r\n        torrent.on('warning', function (warn) {\r\n            console.log(warn);\r\n        })\r\n        torrent.on('error', function (err) {\r\n            console.log(err);\r\n        })\r\n        this.torrentCallback(torrent);\r\n    }\r\n\r\n    seedContent(content, torrentCallback) {\r\n        let buf = Buffer.from(content)\r\n        let tor = this.player.seed(buf, torrentCallback);\r\n        tor.on('infoHash', (infoHash) => {\r\n            torrentCallback(tor);\r\n        })\r\n    }\r\n\r\n    seed(files) {\r\n        if (files.length === 0) return\r\n        //console.log('Seeding ' + files.length + ' files')\r\n        this.onStartCallback(files)\r\n        // Seed from WebTorrent\r\n        setTimeout(() => {\r\n            let tor = this.player.seed(files, this.onSeedTorrent.bind(this));\r\n            tor.on('infoHash', (infoHash) => {\r\n                this.torrentCallback(tor);\r\n            })\r\n        }, 1000);\r\n    }\r\n    //\r\n    onFiles(files) {\r\n        console.log('got files:')\r\n        files.forEach(function (file) {\r\n            // console.log(' - %s (%s bytes)', file.name, file.size)\r\n        })\r\n\r\n        // .torrent file = start downloading the torrent\r\n        //files.filter(isTorrentFile).forEach(downloadTorrentFile)\r\n\r\n        // everything else = seed these files\r\n        this.seed(files)\r\n    }\r\n\r\n    uploadElement(elem, onStartCallback, opts, cb) {\r\n        if (typeof opts === 'function') {\r\n            cb = opts;\r\n            opts = {};\r\n        }\r\n        if (typeof opts === 'string') opts = { type: opts };\r\n\r\n        elem.addEventListener('change', function (ev) {\r\n            if (elem.files.length === 0) return cb(null, []);\r\n            if (onStartCallback)\r\n                onStartCallback(null)\r\n            var reader = new FileReader();\r\n            var index = 0;\r\n            var results = [];\r\n\r\n            reader.addEventListener('load', function (e) {\r\n                results.push({\r\n                    file: elem.files[index],\r\n                    target: e.target\r\n                });\r\n                index++;\r\n                if (index === elem.files.length) cb(null, results)\r\n                else read(index)\r\n            });\r\n            read(index);\r\n\r\n            function read(index) {\r\n                var file = elem.files[index];\r\n                if (opts.type === 'text') {\r\n                    reader.readAsText(file);\r\n                }\r\n                else if (opts.type === 'url') {\r\n                    reader.readAsDataURL(file);\r\n                }\r\n                else reader.readAsArrayBuffer(file);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Pagination, PaginationItem, PaginationLink, Row, Table } from 'reactstrap';\r\nimport { Button, Input, InputGroup, InputGroupAddon, InputGroupText, Alert } from 'reactstrap';\r\nimport { CardGroup, Container, Form, FormGroup, Fade, Collapse, Label, ListGroup, ListGroupItem, ListGroupItemHeading, ListGroupItemText } from 'reactstrap'\r\nimport { Modal, ModalBody, ModalFooter, ModalHeader, Popover, PopoverBody, PopoverHeader } from 'reactstrap'\r\nimport { getFileHost, calcAccountId, getCurrentHost } from '../js/gegeUtil.js'\r\nimport { loadMinerResource } from '../../eshop/eshop'\r\nconst ZkerPlayer = require('zker-player')\r\nconst Resumable = require('resumablejs')\r\nconst ShareManager = require('../js/share').default\r\nconst { postSafe, loadLocalAccount, signString } = require('../js/gegeUtil')\r\nclass WebMiner extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    let res = { tags: '', price: '', fee: '', deadline: '', owner: '', id: '' }\r\n    this.state = { collapse: true, resourceList: [], resource: res, rsId: '账号未登陆' }\r\n    this.state.shareMsg = '';\r\n    this.share = new ShareManager();\r\n    this.userSec = ''\r\n    this.fee = 0.01;\r\n    this.deadline = 5;\r\n    this.price = 0;\r\n    this.tags = ''\r\n    this.resName = ''\r\n    this.resId = ''\r\n    this.infoInterval = null\r\n    this.torrentList = []\r\n    this.resume = null;\r\n    this.html5File = null;\r\n    this.torrent = null;\r\n    this.poster = null;\r\n    this.tokenCount = new Map();\r\n  }\r\n\r\n  cancelShare() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  componentDidMount() {\r\n    var account = loadLocalAccount();\r\n    if (account && account.secret) {\r\n      this.userSec = account.secret;\r\n      this.setState({ rsId: account.rsId })\r\n    }\r\n    this.share.init(this.onTorrentDone.bind(this), this.onTorrentStart.bind(this))\r\n  }\r\n\r\n  initResumable(infoHash, signature) {\r\n    let host = getFileHost()\r\n    let target = host + '/share/' + infoHash + '/' + signature;\r\n    //console.log('target=' + target)\r\n    this.resume = new Resumable({\r\n      target,\r\n      chunkSize: 1 * 1024 * 1024,\r\n      simultaneousUploads: 4,\r\n      testChunks: false,\r\n      throttleProgressCallbacks: 1,\r\n      method: \"octet\"\r\n    });\r\n    //\r\n    this.resume.on('fileAdded', ((file) => {\r\n      console.log('resume got file ' + file)\r\n      if (this.resume)\r\n        this.resume.upload()\r\n      else {\r\n        console.log('this.resume is null')\r\n      }\r\n    }).bind(this))\r\n    this.resume.on('pause', function () {\r\n      console.log('resume pause')\r\n    });\r\n    this.resume.on('complete', () => {\r\n      console.log('resume complete')\r\n      this.setState({ shareMsg: '文件上传成功' })\r\n    });\r\n    this.resume.on('fileSuccess', (file, message) => {\r\n      console.log('resume fileSuccess')\r\n    });\r\n    this.resume.on('fileError', (file, message) => {\r\n      console.log('resume fileError')\r\n      this.setState({ shareMsg: '发布资源出错了', uploadAgain: true })\r\n    });\r\n    this.resume.on('fileProgress', (file) => {\r\n      let p = file.progress() * 100;\r\n      this.setState({ shareMsg: '文件上传中 ' + p + '%' })\r\n    });\r\n    this.resume.on('cancel', function () {\r\n      console.log('resume cancel')\r\n    });\r\n    this.resume.on('uploadStart', function () {\r\n      console.log('resume uploadStart')\r\n    });\r\n  }\r\n\r\n  prettyBytes(num) {\r\n    var exponent, unit, neg = num < 0, units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n    if (neg) num = -num\r\n    if (num < 1) return (neg ? '-' : '') + num + ' B'\r\n    exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1)\r\n    num = Number((num / Math.pow(1000, exponent)).toFixed(2))\r\n    unit = units[exponent]\r\n    return (neg ? '-' : '') + num + ' ' + unit\r\n  }\r\n\r\n  updateTorrentStatus() {\r\n    //console.log('size ' + this.torrentList.length)\r\n    this.torrentList.map((torrent) => {\r\n      //uploadSpeed peers\r\n      let peersSpan = document.querySelector('#pid' + torrent.infoHash);\r\n      if (peersSpan)\r\n        peersSpan.innerHTML = torrent.numPeers;\r\n      //\r\n      let speedSpan = document.querySelector('#sid' + torrent.infoHash);\r\n      if (speedSpan)\r\n        speedSpan.innerHTML = this.prettyBytes(torrent.uploadSpeed) + '/s';\r\n      //rtoken\r\n      let tokenSpan = document.querySelector('#rto' + torrent.infoHash);\r\n      if (tokenSpan)\r\n        tokenSpan.innerHTML = this.prettyBytes(torrent.rtokens) + '个';\r\n    })\r\n  }\r\n\r\n\r\n  onTorrentStart(html5Files) {\r\n    this.setState({ shareMsg: '处理中...(大文件可能会比较慢,请耐心等待)' })\r\n    if (html5Files) {\r\n      this.html5File = html5Files[0];\r\n    }\r\n  }\r\n\r\n  addServerResoruce() {\r\n    let downloadId = this.state.downloadId;\r\n    if (downloadId) {\r\n      this.download(downloadId)\r\n    } else {\r\n      //get one random id from server\r\n      loadMinerResource((ok, resources) => {\r\n        if (ok)\r\n          resources.map((r) => {\r\n            this.download(r.id)\r\n          })\r\n      })\r\n    }\r\n  }\r\n\r\n  handleResourceToken(resId, rtoken) {\r\n    let lastKey = resId + '-lst';\r\n    let lastToken = localStorage.getItem(lastKey)\r\n    if (rtoken === lastToken) {\r\n      //exist\r\n    } else {\r\n      localStorage.setItem(lastKey, rtoken)\r\n      let newKey = resId + ':' + new Date().getTime();\r\n      localStorage.setItem(newKey, rtoken)\r\n    }\r\n    //update count\r\n    if (this.tokenCount.has(resId)) {\r\n      let count = this.tokenCount.get(resId)\r\n      this.tokenCount.set(resId, count + 1)\r\n    } else {\r\n      this.tokenCount.set(resId, 1)\r\n    }\r\n    //\r\n    let count = this.tokenCount.get(resId)\r\n    let tokenSpan = document.querySelector('#rto' + resId);\r\n    if (tokenSpan)\r\n      tokenSpan.innerHTML = count + '';\r\n  }\r\n\r\n  download(downloadId) {\r\n    var config = { secret: this.userSec };\r\n    var player = new ZkerPlayer(downloadId, config)\r\n    let resourceTokenCallBack = (rtoken) => {\r\n      this.handleResourceToken(downloadId, rtoken)\r\n    }\r\n    player.download(downloadId, { resourceTokenCallBack }, (torrent) => {\r\n      let resId = torrent.infoHash\r\n      let resName = torrent.name;\r\n      var rlist = this.state.resourceList;\r\n      rlist.push({ id: resId, name: resName })\r\n      this.setState({ resourceList: rlist })\r\n      this.torrentList.unshift(torrent)\r\n    })\r\n  }\r\n\r\n  onTorrentDone(torrent) {\r\n    this.setState({ ready: true })\r\n    if (torrent) {\r\n      this.torrent = torrent;\r\n      var info = 'Torrent info hash: ' + torrent.infoHash +\r\n        'magnetURI=' + torrent.magnetURI +\r\n        ' torrentFileBlobURL=\"' + torrent.torrentFileBlobURL + 'name=' + torrent.name;\r\n      //console.log(info);\r\n      this.resId = torrent.infoHash\r\n      this.resName = torrent.name;\r\n      var rlist = this.state.resourceList;\r\n      rlist.push({ id: this.resId, name: this.resName })\r\n      this.setState({ resourceList: rlist })\r\n      torrent.key = torrent.infoHash;\r\n      //tags is not set yet\r\n      //torrent.tags = this.tags;\r\n      this.torrentList.unshift(torrent)\r\n      // torrentPoster(torrent, (err, buf, extension) => {\r\n      //   if (err) {\r\n      //     console.log(err)\r\n      //   } else {\r\n      //     // console.log('torrentPoster ' + err + ' ' + buf.toString('base64') + ' ext=' + extension)\r\n      //     this.poster = buf.toString('base64')\r\n      //   }\r\n      // })\r\n    }\r\n    if (!this.infoInterval) {\r\n      this.infoInterval = setInterval(this.updateTorrentStatus.bind(this), 3000);\r\n    }\r\n    this.setState({ shareMsg: '' })\r\n  }\r\n\r\n  updateDownloadId(e) {\r\n    if (e && e.target) {\r\n      let downloadId = e.target.value;\r\n      this.setState({ downloadId })\r\n    }\r\n  }\r\n\r\n\r\n  updateFee(e) {\r\n    if (e && e.target) {\r\n      this.fee = e.target.value;\r\n    }\r\n  }\r\n\r\n  updatePrice(e) {\r\n    if (e && e.target) {\r\n      this.price = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateTags(e) {\r\n    if (e && e.target) {\r\n      this.tags = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateDeadline(e) {\r\n    if (e && e.target) {\r\n      this.deadline = e.target.value;\r\n    }\r\n  }\r\n\r\n  renderAddFile() {\r\n    return (<Row>\r\n      <Col xs=\"12\">\r\n        <Fade>\r\n          <Card>\r\n            <CardHeader>\r\n              <i className=\"icon-share\" onClick={this.toggle.bind(this)}>流量矿工赚积分</i>\r\n              <div className=\"card-header-actions\">\r\n                <Button color=\"link\" className=\"card-header-action btn-setting\"><i className=\"icon-settings\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-minimize\" data-target=\"#collapseExample\" onClick={this.toggle.bind(this)}><i className=\"icon-arrow-up\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-close\" onClick={this.toggleFade}><i className=\"icon-close\"></i></Button>\r\n              </div>\r\n            </CardHeader>\r\n            <Collapse isOpen={this.state.collapse} id=\"collapseExample\">\r\n              <CardBody>\r\n                {/* <FormGroup>\r\n                  <Label htmlFor=\"appendedInputButtons\">账户密码:</Label>\r\n                  <div className=\"controls\">\r\n                    <InputGroup>\r\n                      <Input id=\"appendedInputButtons\" size=\"16\" type=\"text\" value={this.secret} onChange={this.updateSecret.bind(this)} placeholder='输入账户密码共享资源' />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup> */}\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>我的账号:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input id=\"prependedInput\" size=\"16\" type=\"text\" value={this.state.rsId} />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>获取服务器资源:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input id=\"appendedInputButtons\" size=\"16\" type=\"text\" onChange={this.updateDownloadId} placeholder='此处填写资源ID,ID为空则从服务器随机下载' />\r\n                      <Button color=\"danger\" onClick={() => this.addServerResoruce()}>下载</Button>\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>选择本地资源提供流量:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <input name=\"upload\" type=\"file\"></input>\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n              </CardBody>\r\n            </Collapse>\r\n          </Card>\r\n        </Fade>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  renderUploadAgainButton() {\r\n    if (!this.state.uploadAgain)\r\n      return null\r\n    return (\r\n      <Button type=\"submit\" color=\"primary\" onClick={(e) => this.uploadAgain()}>重新上传</Button>\r\n    )\r\n  }\r\n\r\n\r\n\r\n  renderResourceItems() {\r\n    let items = this.state.resourceList.map((res) => {\r\n      let pid = 'pid' + res.id;\r\n      let sid = 'sid' + res.id;\r\n      let rid = 'rto' + res.id;\r\n      let confirms = 0;\r\n      return (<ListGroupItem action>\r\n        <ListGroupItemHeading>{res.name}   <PopoverItem id={res.id} res={res} /></ListGroupItemHeading>\r\n        <ListGroupItemText>\r\n          <code> <span id={pid}></span>节点</code>. &#x2197;<code><span id={sid}></span>上传速度</code> <code><span id={rid}>{confirms}</span>个确认信息</code>\r\n        </ListGroupItemText>\r\n      </ListGroupItem>)\r\n    })\r\n    return items;\r\n  }\r\n\r\n  renderShareList() {\r\n    return (<Row>\r\n      <Col sm=\"12\" xl=\"6\">\r\n        <Card>\r\n          <CardHeader>\r\n            <i className=\"fa fa-align-justify\"></i><strong>资源列表</strong>\r\n            <Alert color=\"danger\"><small>流量矿工通过分享本机硬盘与网络流量为其他用户提供资源下载服务。其他用户成功下载资源后会留下确认信息，流量矿工用收集到的确认信息换取眞客积分。请不要刷新或关闭此页面，保持此页面打开状态下，网络上其他用户才可以下载资源</small></Alert>\r\n          </CardHeader>\r\n          <CardBody>\r\n            <ListGroup>\r\n              {this.renderResourceItems()}\r\n            </ListGroup>\r\n          </CardBody>\r\n        </Card>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        {this.renderAddFile()}\r\n        <div>\r\n          <Alert color=\"info\">{this.state.shareMsg}</Alert>\r\n        </div>\r\n        {this.renderShareList()}\r\n      </div>\r\n\r\n    );\r\n  }\r\n}\r\n\r\n\r\nclass PopoverItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.toggle = this.toggle.bind(this);\r\n    this.state = {\r\n      popoverOpen: false\r\n    };\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({\r\n      popoverOpen: !this.state.popoverOpen,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <span>\r\n        <span className='alert-primary  fade show' id={'Popover-' + this.props.id} onClick={this.toggle}>\r\n          (分享链接)\r\n          </span>\r\n        <Popover placement='top' isOpen={this.state.popoverOpen} target={'Popover-' + this.props.id} toggle={this.toggle}>\r\n          <PopoverHeader>分享这个资源的链接,获取更多确认信息</PopoverHeader>\r\n          <PopoverBody>{getCurrentHost() + \"/#/btb#\" + this.props.res.id + '#' + this.props.res.name}</PopoverBody>\r\n        </Popover>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport default WebMiner;\r\n"],"sourceRoot":""}