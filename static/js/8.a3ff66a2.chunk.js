(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{845:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"default",function(){return s});var n=a(21),r=a(22),l=a(399),s=function(){function t(){Object(n.a)(this,t),this.player=new l("",{}),this.torrentCallback=null,this.onStartCallback=null}return Object(r.a)(t,[{key:"init",value:function(e,t,a){this.torrentCallback=e,this.onStartCallback=t;var n=a;n||(n=document.querySelector("input[name=upload]")),n&&this.uploadElement(n,this.onStartCallback,function(e,t){if(e)return e;t=t.map(function(e){return e.file}),this.onFiles(t)}.bind(this))}},{key:"isTorrentFile",value:function(e){return-1!==e.name.indexOf(".torrent")}},{key:"isNotTorrentFile",value:function(e){return!this.isTorrentFile(e)}},{key:"onSeedTorrent",value:function(e){e.on("warning",function(e){console.log(e)}),e.on("error",function(e){console.log(e)}),this.torrentCallback(e)}},{key:"seedContent",value:function(t,a){var n=e.from(t),r=this.player.seed(n,a);r.on("infoHash",function(e){a(r)})}},{key:"seed",value:function(e){var t=this;0!==e.length&&(this.onStartCallback(e),setTimeout(function(){var a=t.player.seed(e,t.onSeedTorrent.bind(t));a.on("infoHash",function(e){t.torrentCallback(a)})},1e3))}},{key:"onFiles",value:function(e){console.log("got files:"),e.forEach(function(e){}),this.seed(e)}},{key:"uploadElement",value:function(e,t,a,n){"function"===typeof a&&(n=a,a={}),"string"===typeof a&&(a={type:a}),e.addEventListener("change",function(r){if(0===e.files.length)return n(null,[]);t&&t(null);var l=new FileReader,s=0,i=[];function o(t){var n=e.files[t];"text"===a.type?l.readAsText(n):"url"===a.type?l.readAsDataURL(n):l.readAsArrayBuffer(n)}l.addEventListener("load",function(t){i.push({file:e.files[s],target:t.target}),++s===e.files.length?n(null,i):o(s)}),o(s)})}}]),t}()}.call(this,a(7).Buffer)},919:function(e,t,a){"use strict";var n=a(4),r=a(5),l=a(0),s=a.n(l),i=a(1),o=a.n(i),c=a(3),u=a.n(c),d=a(2),m={tag:d.q,className:o.a.any,cssModule:o.a.object},h=function(e){var t=e.className,a=e.cssModule,l=e.tag,i=Object(r.a)(e,["className","cssModule","tag"]),o=Object(d.m)(u()(t,"list-group-item-heading"),a);return s.a.createElement(l,Object(n.a)({},i,{className:o}))};h.propTypes=m,h.defaultProps={tag:"h5"},t.a=h},920:function(e,t,a){"use strict";var n=a(4),r=a(5),l=a(0),s=a.n(l),i=a(1),o=a.n(i),c=a(3),u=a.n(c),d=a(2),m={tag:d.q,className:o.a.any,cssModule:o.a.object},h=function(e){var t=e.className,a=e.cssModule,l=e.tag,i=Object(r.a)(e,["className","cssModule","tag"]),o=Object(d.m)(u()(t,"list-group-item-text"),a);return s.a.createElement(l,Object(n.a)({},i,{className:o}))};h.propTypes=m,h.defaultProps={tag:"p"},t.a=h},933:function(e,t,a){"use strict";a.r(t);var n=a(21),r=a(22),l=a(24),s=a(23),i=a(25),o=a(0),c=a.n(o),u=a(826),d=a(827),m=a(229),h=a(230),f=a(232),p=a(393),E=a(33),v=a(65),y=a(89),g=a(64),b=a(127),k=a(39),w=a(231),N=a(78),S=a(835),M=a(919),T=a(920),O=a(834),j=a(131),B=a(128),L=a(129),q=a(13),C=a(845).default,x=a(79),H=a(13),I=H.getCurrentHost,F=H.startPlayer,P=a(42),A=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(l.a)(this,Object(s.a)(t).call(this,e))).state={resourceList:[],download:null,loadingMsg:"(\u4e0b\u8f7d\u4e2d) ...",showqr:!1,qrName:""},a.state.shareMsg="",a.share=new C(a.state),a.tags="",a.resName="",a.resId="",a.infoInterval=null,a.torrentList=[],a}return Object(i.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=window.location.hash,t=null,a=null;if(e){var n=e.indexOf("#",1);if(n>0){t=e.substr(n+1,64);var r=e.indexOf("#",n+64);r>0&&(a=e.substr(r+1)),t&&64==t.length&&(a?this.setState({download:a}):this.setState({download:t}),this.startDownload(null,t))}}this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this))}},{key:"startDownload",value:function(e,t){var a=Object(q.getShareHost)()+"/btb?action=p2pTransfer&resId="+t;x.concat({url:a,json:!0},function(a,n,r){if(a)this.setState({shareMsg:"err.\u51fa\u9519\u4e86"});else if(r.ok){P(15).toString("hex");F(e,{id:t,tags:""})}else this.setState({shareMsg:"\u4e0d\u662f\u514d\u8d39\u8d44\u6e90"})}.bind(this))}},{key:"prettyBytes",value:function(e){var t,a=e<0,n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return a&&(e=-e),e<1?(a?"-":"")+e+" B":(t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),n.length-1),(a?"-":"")+(e=Number((e/Math.pow(1e3,t)).toFixed(2)))+" "+n[t])}},{key:"updateTorrentStatus",value:function(){var e=this;this.torrentList.map(function(t){var a=document.querySelector("#pid"+t.infoHash),n=document.querySelector("#sid"+t.infoHash);a&&(a.innerHTML=t.numPeers),n&&(n.innerHTML=e.prettyBytes(t.uploadSpeed)+"/s")})}},{key:"onTorrentStart",value:function(){this.setState({shareMsg:"\u5904\u7406\u4e2d..."})}},{key:"onTorrentDone",value:function(e){if(e){e.infoHash,e.magnetURI,e.torrentFileBlobURL,e.name;this.resId=e.infoHash,this.resName=e.name;var t=this.state.resourceList;t.push({id:this.resId,name:this.resName}),this.setState({resourceList:t}),e.key=e.infoHash,this.torrentList.unshift(e)}this.infoInterval||(this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3e3)),this.setState({shareMsg:""})}},{key:"renderAddFile",value:function(){return c.a.createElement(u.a,null,c.a.createElement(d.a,{xs:"12"},c.a.createElement(k.a,null,c.a.createElement(m.a,null,c.a.createElement(h.a,null,c.a.createElement("i",{className:"icon-share"},"\u70b9\u5bf9\u70b9\u6587\u4ef6\u4f20\u8f93"),c.a.createElement("div",{className:"card-header-actions"},c.a.createElement(E.a,{color:"link",className:"card-header-action btn-setting"},c.a.createElement("i",{className:"icon-settings"})))),c.a.createElement(w.a,{isOpen:!0,id:"collapseExample"},c.a.createElement(f.a,null,c.a.createElement("div",null,c.a.createElement("p",null,"\u9009\u62e9\u8981\u4f20\u8f93\u7684\u6587\u4ef6,\u76f4\u63a5\u53d1\u9001\u7ed9\u597d\u53cb\uff0c\u652f\u6301\u624b\u673a\u4e0e\u7535\u8111\u4e4b\u95f4\u9ad8\u901f\u6587\u4ef6\u4f20\u8f93.")),c.a.createElement(N.a,null,c.a.createElement("div",{className:"controls"},c.a.createElement(v.a,{className:"input-prepend"},c.a.createElement(y.a,{addonType:"prepend"},c.a.createElement(g.a,null,"Resource(\u8d44\u6e90):")),c.a.createElement("input",{name:"upload",type:"file"})))),c.a.createElement("div",null,c.a.createElement("p",null,c.a.createElement(b.a,{color:"danger"},c.a.createElement("small",null,this.state.shareMsg))))))))))}},{key:"showBarcode",value:function(e,t){this.setState({showqr:!0,qrName:t});var a=I()+"/#/fly#"+e+"#"+t;setTimeout(function(){Object(q.showQRDialog)(a)},1500)}},{key:"copyAddress",value:function(e){var t=document.querySelector("#url_"+e);t.focus(),t.select();var a=document.execCommand("copy"),n=document.querySelector("#msg_"+e);n.innerHTML=a?"OK.\u590d\u5236\u6210\u529f":"\u590d\u5236\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236"}},{key:"renderResourceItems",value:function(){var e=this;return this.state.resourceList.map(function(t){var a="pid"+t.id,n="sid"+t.id;return c.a.createElement(S.a,{key:t.id,action:!0},c.a.createElement(M.a,null," ",c.a.createElement("i",{className:"fa fa-barcode",onClick:function(a){return e.showBarcode(t.id,t.name)}}),c.a.createElement("span",null," ",t.name," : \u8bf7\u5c06\u4e0b\u9762\u5730\u5740\u53d1\u7ed9\u597d\u53cb\u4e0b\u8f7d"),c.a.createElement(E.a,{color:"ghost-success",onClick:function(a){return e.copyAddress(t.id)}},c.a.createElement("i",{className:"fa fa-copy fa-lg"}),"\xa0\u590d\u5236\u5730\u5740"),c.a.createElement("span",{className:"alert-primary",id:"msg_"+t.id})),c.a.createElement(M.a,null,c.a.createElement("input",{readOnly:!0,style:{width:"100%"},id:"url_"+t.id,value:I()+"/#/fly#"+t.id+"#"+t.name})),c.a.createElement(T.a,null,c.a.createElement("code",null," ",c.a.createElement("span",{id:a}),"\u8282\u70b9"),". \u2197",c.a.createElement("code",null,c.a.createElement("span",{id:n}),"\u4e0a\u4f20\u901f\u5ea6")))})}},{key:"toggle",value:function(){this.setState({showqr:!this.state.showqr})}},{key:"renderShareList",value:function(){return c.a.createElement(u.a,null,c.a.createElement(d.a,{sm:"12",xl:"6"},c.a.createElement(m.a,null,c.a.createElement(h.a,null,c.a.createElement("i",{className:"fa fa-align-justify"}),c.a.createElement("strong",null,"Transfer List(\u4f20\u8f93\u5217\u8868"),c.a.createElement(b.a,{color:"danger"},c.a.createElement("small",null,"\u8d44\u6e90\u4e0d\u4f1a\u4e0a\u4f20\u7ed9\u4efb\u4f55\u670d\u52a1\u5668\uff0c\u70b9\u5bf9\u70b9\u76f4\u63a5\u4ece\u672c\u5730\u4e0b\u8f7d\u3002Please keep this page open.\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u5173\u95ed\u6b64\u9875\u9762\uff0c\u4fdd\u6301\u6b64\u9875\u9762\u6253\u5f00\u72b6\u6001\u4e0b\uff0c\u6587\u4ef6\u4f20\u8f93\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002\u9875\u9762\u5f02\u5e38\u60c5\u51b5\u53ef\u4ee5\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u7ee7\u7eed\u4f20\u8f93\u3002"))),c.a.createElement(f.a,null,c.a.createElement(O.a,null,this.renderResourceItems()),c.a.createElement(j.a,{isOpen:this.state.showqr,className:this.props.className},c.a.createElement(B.a,{toggle:this.toggle.bind(this)},this.state.qrName),c.a.createElement(L.a,null,c.a.createElement("div",{id:"qrcode"})))))))}},{key:"renderPlayer",value:function(){return this.state.download?c.a.createElement("div",{id:"playdiv"},c.a.createElement(m.a,null,c.a.createElement(h.a,null,this.state.download,c.a.createElement(p.a,{color:"success",className:"float-right"},this.state.loadingMsg)),c.a.createElement(f.a,null,c.a.createElement("div",{id:"status"},c.a.createElement("div",null,c.a.createElement("span",{className:"show-leech"}," from "),c.a.createElement("code",{id:"numPeers"},"0 peers"),".",c.a.createElement("code",{id:"downloadSpeed"},"0 b/s ")," / \u2197",c.a.createElement("code",{id:"uploadSpeed"},"0 b/s - "),c.a.createElement("code",{id:"downloaded"})," of",c.a.createElement("code",{id:"total"})," \u2014",c.a.createElement("span",{id:"remaining"}))),c.a.createElement("div",{id:"player",style:{width:"100%"}})))):null}},{key:"render",value:function(){return c.a.createElement("div",{className:"animated fadeIn"},this.renderPlayer(),this.renderAddFile(),this.renderShareList())}}]),t}(o.Component);t.default=A}}]);