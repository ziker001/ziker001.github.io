(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{845:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"default",function(){return s});var n=a(21),r=a(22),l=a(399),s=function(){function t(){Object(n.a)(this,t);this.client=new l({tracker:{rtcConfig:{iceServers:[{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun.btbresource.com:3478"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]}},dht:!1}),this.torrentCallback=null,this.onStartCallback=null}return Object(r.a)(t,[{key:"init",value:function(e,t,a){this.torrentCallback=e,this.onStartCallback=t;var n=a;n||(n=document.querySelector("input[name=upload]")),n&&this.uploadElement(n,this.onStartCallback,function(e,t){if(e)return e;t=t.map(function(e){return e.file}),this.onFiles(t)}.bind(this))}},{key:"isTorrentFile",value:function(e){return-1!==e.name.indexOf(".torrent")}},{key:"isNotTorrentFile",value:function(e){return!this.isTorrentFile(e)}},{key:"onSeedTorrent",value:function(e){e.on("warning",function(e){console.log(e)}),e.on("error",function(e){console.log(e)}),this.torrentCallback(e)}},{key:"seedContent",value:function(t,a){var n=e.from(t),r=this.client.seed(n,a);r.on("infoHash",function(e){a(r)})}},{key:"seed",value:function(e){var t=this;0!==e.length&&(this.onStartCallback(e),setTimeout(function(){var a=t.client.seed(e,t.onSeedTorrent.bind(t));a.on("infoHash",function(e){t.torrentCallback(a)})},1e3))}},{key:"onFiles",value:function(e){console.log("got files:"),e.forEach(function(e){}),this.seed(e)}},{key:"uploadElement",value:function(e,t,a,n){"function"===typeof a&&(n=a,a={}),"string"===typeof a&&(a={type:a}),e.addEventListener("change",function(r){if(0===e.files.length)return n(null,[]);t&&t(null);var l=new FileReader,s=0,i=[];function o(t){var n=e.files[t];"text"===a.type?l.readAsText(n):"url"===a.type?l.readAsDataURL(n):l.readAsArrayBuffer(n)}l.addEventListener("load",function(t){i.push({file:e.files[s],target:t.target}),++s===e.files.length?n(null,i):o(s)}),o(s)})}}]),t}()}.call(this,a(7).Buffer)},935:function(e,t,a){"use strict";a.r(t);var n=a(51),r=a(21),l=a(22),s=a(24),i=a(23),o=a(25),c=a(0),u=a.n(c),d=a(826),m=a(827),h=a(229),p=a(230),f=a(232),g=a(33),v=a(65),E=a(89),k=a(64),y=a(77),b=a(127),S=a(40),O=a(231),C=a(78),N=a(835),T=a(919),j=a(920),I=a(834),w=a(397),B=a(394),L=a(395),M=a(13),F=a(878),A=a(845).default,H=a(13),x=(H.postSafe,H.loadLocalAccount),P=(H.signString,function(e){function t(e){var a;Object(r.a)(this,t);return(a=Object(s.a)(this,Object(i.a)(t).call(this,e))).state={collapse:!0,resourceList:[],resource:{tags:"",price:"",fee:"",deadline:"",owner:"",id:""},rsId:""},a.state.shareMsg="",a.share=new A,a.userSec="",a.fee=.01,a.deadline=5,a.price=0,a.tags="",a.resName="",a.resId="",a.infoInterval=null,a.torrentList=[],a.resume=null,a.html5File=null,a.torrent=null,a.poster=null,a}return Object(o.a)(t,e),Object(l.a)(t,[{key:"cancelShare",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"toggle",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"componentDidMount",value:function(){var e=x();e&&e.secret&&(this.userSec=e.secret,this.setState({rsId:e.rsId})),this.share.init(this.onTorrentDone.bind(this),this.onTorrentStart.bind(this))}},{key:"initResumable",value:function(e,t){var a=this,n=Object(M.getFileHost)()+"/share/"+e+"/"+t;this.resume=new F({target:n,chunkSize:1048576,simultaneousUploads:4,testChunks:!1,throttleProgressCallbacks:1,method:"octet"}),this.resume.on("fileAdded",function(e){console.log("resume got file "+e),a.resume?a.resume.upload():console.log("this.resume is null")}.bind(this)),this.resume.on("pause",function(){console.log("resume pause")}),this.resume.on("complete",function(){console.log("resume complete"),a.setState({shareMsg:"\u6587\u4ef6\u4e0a\u4f20\u6210\u529f"})}),this.resume.on("fileSuccess",function(e,t){console.log("resume fileSuccess")}),this.resume.on("fileError",function(e,t){console.log("resume fileError"),a.setState({shareMsg:"\u53d1\u5e03\u8d44\u6e90\u51fa\u9519\u4e86",uploadAgain:!0})}),this.resume.on("fileProgress",function(e){var t=100*e.progress();a.setState({shareMsg:"\u6587\u4ef6\u4e0a\u4f20\u4e2d "+t+"%"})}),this.resume.on("cancel",function(){console.log("resume cancel")}),this.resume.on("uploadStart",function(){console.log("resume uploadStart")})}},{key:"prettyBytes",value:function(e){var t,a=e<0,n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return a&&(e=-e),e<1?(a?"-":"")+e+" B":(t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),n.length-1),(a?"-":"")+(e=Number((e/Math.pow(1e3,t)).toFixed(2)))+" "+n[t])}},{key:"updateTorrentStatus",value:function(){var e=this;this.torrentList.map(function(t){var a=document.querySelector("#pid"+t.infoHash);a&&(a.innerHTML=t.numPeers);var n=document.querySelector("#sid"+t.infoHash);n&&(n.innerHTML=e.prettyBytes(t.uploadSpeed)+"/s")})}},{key:"onTorrentStart",value:function(e){this.setState({shareMsg:"\u5904\u7406\u4e2d...(\u5927\u6587\u4ef6\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162,\u8bf7\u8010\u5fc3\u7b49\u5f85)"}),e&&(this.html5File=e[0])}},{key:"onTorrentDone",value:function(e){if(this.setState({ready:!0}),e){this.torrent=e;e.infoHash,e.magnetURI,e.torrentFileBlobURL,e.name;this.resId=e.infoHash,this.resName=e.name;var t=this.state.resourceList;t.push({id:this.resId,name:this.resName}),this.setState({resourceList:t}),e.key=e.infoHash,this.torrentList.unshift(e)}this.infoInterval||(this.infoInterval=setInterval(this.updateTorrentStatus.bind(this),3e3)),this.setState({shareMsg:""})}},{key:"updateSecret",value:function(e){if(e&&e.target){this.userSec=e.target.value;var t=Object(M.calcAccountId)(this.userSec);this.setState({rsId:t})}}},{key:"updateFee",value:function(e){e&&e.target&&(this.fee=e.target.value)}},{key:"updatePrice",value:function(e){e&&e.target&&(this.price=e.target.value)}},{key:"updateTags",value:function(e){e&&e.target&&(this.tags=e.target.value)}},{key:"updateDeadline",value:function(e){e&&e.target&&(this.deadline=e.target.value)}},{key:"renderAddFile",value:function(){return u.a.createElement(d.a,null,u.a.createElement(m.a,{xs:"12"},u.a.createElement(S.a,null,u.a.createElement(h.a,null,u.a.createElement(p.a,null,u.a.createElement("i",{className:"icon-share",onClick:this.toggle.bind(this)},"\u6d41\u91cf\u77ff\u5de5\u8d5a\u79ef\u5206"),u.a.createElement("div",{className:"card-header-actions"},u.a.createElement(g.a,{color:"link",className:"card-header-action btn-setting"},u.a.createElement("i",{className:"icon-settings"})),u.a.createElement(g.a,{color:"link",className:"card-header-action btn-minimize","data-target":"#collapseExample",onClick:this.toggle.bind(this)},u.a.createElement("i",{className:"icon-arrow-up"})),u.a.createElement(g.a,{color:"link",className:"card-header-action btn-close",onClick:this.toggleFade},u.a.createElement("i",{className:"icon-close"})))),u.a.createElement(O.a,{isOpen:this.state.collapse,id:"collapseExample"},u.a.createElement(f.a,null,u.a.createElement(C.a,null,u.a.createElement("div",{className:"controls"},u.a.createElement(v.a,{className:"input-prepend"},u.a.createElement(E.a,{addonType:"prepend"},u.a.createElement(k.a,null,"\u6211\u7684\u8d26\u53f7:")),u.a.createElement(y.a,{id:"prependedInput",size:"16",type:"text",value:this.state.rsId})))),u.a.createElement(C.a,null,u.a.createElement("div",{className:"controls"},u.a.createElement(v.a,{className:"input-prepend"},u.a.createElement(E.a,{addonType:"prepend"},u.a.createElement(k.a,null,"\u672c\u5730\u8d44\u6e90:")),u.a.createElement("input",{name:"upload",type:"file"}))))))))))}},{key:"renderUploadAgainButton",value:function(){var e=this;return this.state.uploadAgain?u.a.createElement(g.a,{type:"submit",color:"primary",onClick:function(t){return e.uploadAgain()}},"\u91cd\u65b0\u4e0a\u4f20"):null}},{key:"renderResourceItems",value:function(){return this.state.resourceList.map(function(e){var t="pid"+e.id,a="sid"+e.id;return u.a.createElement(N.a,{action:!0},u.a.createElement(T.a,null,e.name,"   ",u.a.createElement(R,{id:e.id,res:e})),u.a.createElement(j.a,null,u.a.createElement("code",null," ",u.a.createElement("span",{id:t}),"\u8282\u70b9"),". \u2197",u.a.createElement("code",null,u.a.createElement("span",{id:a}),"\u4e0a\u4f20\u901f\u5ea6")," ",u.a.createElement("code",null,u.a.createElement("span",{id:a},0),"\u4e2a\u786e\u8ba4\u4fe1\u606f")))})}},{key:"renderShareList",value:function(){return u.a.createElement(d.a,null,u.a.createElement(m.a,{sm:"12",xl:"6"},u.a.createElement(h.a,null,u.a.createElement(p.a,null,u.a.createElement("i",{className:"fa fa-align-justify"}),u.a.createElement("strong",null,"\u8d44\u6e90\u5217\u8868"),u.a.createElement(b.a,{color:"danger"},u.a.createElement("small",null,"\u6d41\u91cf\u77ff\u5de5\u901a\u8fc7\u5206\u4eab\u672c\u673a\u786c\u76d8\u4e0e\u7f51\u7edc\u6d41\u91cf\u4e3a\u5176\u4ed6\u7528\u6237\u63d0\u4f9b\u8d44\u6e90\u4e0b\u8f7d\u670d\u52a1\u3002\u5176\u4ed6\u7528\u6237\u6210\u529f\u4e0b\u8f7d\u8d44\u6e90\u540e\u4f1a\u7559\u4e0b\u786e\u8ba4\u4fe1\u606f\uff0c\u6d41\u91cf\u77ff\u5de5\u7528\u6536\u96c6\u5230\u7684\u786e\u8ba4\u4fe1\u606f\u6362\u53d6\u771e\u5ba2\u79ef\u5206\u3002\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u5173\u95ed\u6b64\u9875\u9762\uff0c\u4fdd\u6301\u6b64\u9875\u9762\u6253\u5f00\u72b6\u6001\u4e0b\uff0c\u7f51\u7edc\u4e0a\u5176\u4ed6\u7528\u6237\u624d\u53ef\u4ee5\u4e0b\u8f7d\u8d44\u6e90"))),u.a.createElement(f.a,null,u.a.createElement(I.a,null,this.renderResourceItems())))))}},{key:"render",value:function(){return u.a.createElement("div",{className:"animated fadeIn"},this.renderAddFile(),u.a.createElement("div",null,u.a.createElement(b.a,{color:"info"},this.state.shareMsg)),this.renderShareList())}}]),t}(c.Component)),R=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(s.a)(this,Object(i.a)(t).call(this,e))).toggle=a.toggle.bind(Object(n.a)(Object(n.a)(a))),a.state={popoverOpen:!1},a}return Object(o.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({popoverOpen:!this.state.popoverOpen})}},{key:"render",value:function(){return u.a.createElement("span",null,u.a.createElement("span",{className:"alert-primary  fade show",id:"Popover-"+this.props.id,onClick:this.toggle},"(\u5206\u4eab\u94fe\u63a5)"),u.a.createElement(w.a,{placement:"top",isOpen:this.state.popoverOpen,target:"Popover-"+this.props.id,toggle:this.toggle},u.a.createElement(B.a,null,"\u5206\u4eab\u8fd9\u4e2a\u8d44\u6e90\u7684\u94fe\u63a5,\u83b7\u53d6\u66f4\u591a\u786e\u8ba4\u4fe1\u606f"),u.a.createElement(L.a,null,Object(M.getCurrentHost)()+"/#/btb#"+this.props.res.id+"#"+this.props.res.name)))}}]),t}(c.Component);t.default=P}}]);
//# sourceMappingURL=15.27aa66e1.chunk.js.map