{"version":3,"sources":["views/ggv/js/share.js","views/ggv/WebMiner/WebMiner.js"],"names":["WebTorrent","require","ShareManager","Object","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","client","tracker","rtcConfig","iceServers","urls","dht","torrentCallback","onStartCallback","uploadInput","up","document","querySelector","uploadElement","err","files","map","file","onFiles","bind","name","indexOf","isTorrentFile","torrent","on","warn","console","log","content","buf","Buffer","from","tor","seed","infoHash","_this","length","setTimeout","onSeedTorrent","forEach","elem","opts","cb","type","addEventListener","ev","reader","FileReader","index","results","read","readAsText","readAsDataURL","readAsArrayBuffer","e","push","target","module","exports","Resumable","postSafe","loadLocalAccount","signString","WebMiner","props","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","state","collapse","resourceList","resource","tags","price","fee","deadline","owner","id","rsId","shareMsg","share","userSec","resName","resId","infoInterval","torrentList","resume","html5File","poster","setState","_this2","torrentFile","toString","req","time","Date","getTime","signature","host","getFileHost","url","nonce","res","initResumable","addFile","account","secret","init","onTorrentDone","onTorrentStart","_this3","chunkSize","simultaneousUploads","testChunks","throttleProgressCallbacks","method","upload","message","uploadAgain","p","progress","num","exponent","neg","units","Math","min","floor","Number","pow","toFixed","_this4","peersSpan","innerHTML","numPeers","speedSpan","prettyBytes","uploadSpeed","html5Files","ready","magnetURI","torrentFileBlobURL","rlist","key","unshift","setInterval","updateTorrentStatus","value","calcAccountId","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","reactstrap__WEBPACK_IMPORTED_MODULE_7__","reactstrap__WEBPACK_IMPORTED_MODULE_8__","xs","reactstrap__WEBPACK_IMPORTED_MODULE_18__","reactstrap__WEBPACK_IMPORTED_MODULE_9__","reactstrap__WEBPACK_IMPORTED_MODULE_10__","className","onClick","toggle","reactstrap__WEBPACK_IMPORTED_MODULE_12__","color","data-target","toggleFade","reactstrap__WEBPACK_IMPORTED_MODULE_19__","isOpen","reactstrap__WEBPACK_IMPORTED_MODULE_11__","reactstrap__WEBPACK_IMPORTED_MODULE_20__","reactstrap__WEBPACK_IMPORTED_MODULE_13__","reactstrap__WEBPACK_IMPORTED_MODULE_14__","addonType","reactstrap__WEBPACK_IMPORTED_MODULE_15__","reactstrap__WEBPACK_IMPORTED_MODULE_16__","size","_this5","pid","sid","reactstrap__WEBPACK_IMPORTED_MODULE_21__","action","reactstrap__WEBPACK_IMPORTED_MODULE_22__","PopoverItem","reactstrap__WEBPACK_IMPORTED_MODULE_23__","sm","xl","reactstrap__WEBPACK_IMPORTED_MODULE_17__","reactstrap__WEBPACK_IMPORTED_MODULE_24__","renderResourceItems","renderAddFile","renderShareList","Component","_this6","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_0__","popoverOpen","reactstrap__WEBPACK_IMPORTED_MODULE_25__","placement","reactstrap__WEBPACK_IMPORTED_MODULE_26__","reactstrap__WEBPACK_IMPORTED_MODULE_27__","getCurrentHost"],"mappings":"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","file":"static/js/19.27f393d8.chunk.js","sourcesContent":["const WebTorrent = require('flycat-torrent')\r\n\r\nclass ShareManager {\r\n\r\n    constructor() {\r\n        let rtcConfig = {\r\n            \"iceServers\": [\r\n                { \"urls\": \"stun:stun2.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun3.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun.btbresource.com:3478\" },\r\n                {\r\n                    \"urls\": \"stun:global.stun.twilio.com:3478?transport=udp\"\r\n                }\r\n            ]\r\n        };\r\n        this.client = new WebTorrent({\r\n            tracker: {\r\n                rtcConfig: rtcConfig\r\n            },\r\n            dht: false\r\n        })\r\n        this.torrentCallback = null\r\n        this.onStartCallback = null\r\n    }\r\n\r\n    init(torrentCallback, onStartCallback, uploadInput) {\r\n        this.torrentCallback = torrentCallback;\r\n        this.onStartCallback = onStartCallback;\r\n        var up = uploadInput;\r\n        if (!up)\r\n            up = document.querySelector('input[name=upload]')\r\n        if (up) {\r\n            this.uploadElement(up, this.onStartCallback, (function (err, files) {\r\n                if (err) return err;\r\n                files = files.map(function (file) { return file.file })\r\n                this.onFiles(files)\r\n            }).bind(this))\r\n        }\r\n    }\r\n\r\n    isTorrentFile(file) {\r\n        //var extname = path.extname(file.name).toLowerCase()\r\n        return file.name.indexOf('.torrent') !== -1;\r\n    }\r\n\r\n    isNotTorrentFile(file) {\r\n        return !this.isTorrentFile(file)\r\n    }\r\n\r\n    onSeedTorrent(torrent) {\r\n        torrent.on('warning', function (warn) {\r\n            console.log(warn);\r\n        })\r\n        torrent.on('error', function (err) {\r\n            console.log(err);\r\n        })\r\n        this.torrentCallback(torrent);\r\n    }\r\n\r\n    seedContent(content,torrentCallback) {\r\n        let buf = Buffer.from(content)\r\n        let tor = this.client.seed(buf, torrentCallback);\r\n        tor.on('infoHash', (infoHash) => {\r\n            torrentCallback(tor);\r\n        })\r\n    }\r\n\r\n    seed(files) {\r\n        if (files.length === 0) return\r\n        //console.log('Seeding ' + files.length + ' files')\r\n        this.onStartCallback(files)\r\n        // Seed from WebTorrent\r\n        setTimeout(() => {\r\n            let tor = this.client.seed(files, this.onSeedTorrent.bind(this));\r\n            tor.on('infoHash', (infoHash) => {\r\n                this.torrentCallback(tor);\r\n            })\r\n        }, 1000);\r\n    }\r\n    //\r\n    onFiles(files) {\r\n        console.log('got files:')\r\n        files.forEach(function (file) {\r\n            // console.log(' - %s (%s bytes)', file.name, file.size)\r\n        })\r\n\r\n        // .torrent file = start downloading the torrent\r\n        //files.filter(isTorrentFile).forEach(downloadTorrentFile)\r\n\r\n        // everything else = seed these files\r\n        this.seed(files)\r\n    }\r\n\r\n    uploadElement(elem, onStartCallback, opts, cb) {\r\n        if (typeof opts === 'function') {\r\n            cb = opts;\r\n            opts = {};\r\n        }\r\n        if (typeof opts === 'string') opts = { type: opts };\r\n\r\n        elem.addEventListener('change', function (ev) {\r\n            if (elem.files.length === 0) return cb(null, []);\r\n            if (onStartCallback)\r\n                onStartCallback(null)\r\n            var reader = new FileReader();\r\n            var index = 0;\r\n            var results = [];\r\n\r\n            reader.addEventListener('load', function (e) {\r\n                results.push({\r\n                    file: elem.files[index],\r\n                    target: e.target\r\n                });\r\n                index++;\r\n                if (index === elem.files.length) cb(null, results)\r\n                else read(index)\r\n            });\r\n            read(index);\r\n\r\n            function read(index) {\r\n                var file = elem.files[index];\r\n                if (opts.type === 'text') {\r\n                    reader.readAsText(file);\r\n                }\r\n                else if (opts.type === 'url') {\r\n                    reader.readAsDataURL(file);\r\n                }\r\n                else reader.readAsArrayBuffer(file);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = ShareManager;","import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Pagination, PaginationItem, PaginationLink, Row, Table } from 'reactstrap';\r\nimport { Button, Input, InputGroup, InputGroupAddon, InputGroupText, Alert } from 'reactstrap';\r\nimport { CardGroup, Container, Form, FormGroup, Fade, Collapse, Label, ListGroup, ListGroupItem, ListGroupItemHeading, ListGroupItemText } from 'reactstrap'\r\nimport { Modal, ModalBody, ModalFooter, ModalHeader, Popover, PopoverBody, PopoverHeader } from 'reactstrap'\r\nimport { createPeerId, getFileHost, loadAccountInfo, calcAccountId, getCurrentHost } from '../js/gegeUtil.js'\r\nimport { doBShopTransaction } from '../../eshop/eshop.js'\r\nconst Resumable = require('resumablejs')\r\nconst ShareManager = require('../js/share')\r\nconst { postSafe, loadLocalAccount, signString } = require('../js/gegeUtil')\r\nclass WebMiner extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    let res = { tags: '', price: '', fee: '', deadline: '', owner: '', id: '' }\r\n    this.state = { collapse: true, resourceList: [], resource: res, rsId: '' }\r\n    this.state.shareMsg = '';\r\n    this.share = new ShareManager();\r\n    this.userSec = ''\r\n    this.fee = 0.01;\r\n    this.deadline = 5;\r\n    this.price = 0;\r\n    this.tags = ''\r\n    this.resName = ''\r\n    this.resId = ''\r\n    this.infoInterval = null\r\n    this.torrentList = []\r\n    this.resume = null;\r\n    this.html5File = null;\r\n    this.torrent = null;\r\n    this.poster = null;\r\n  }\r\n\r\n  cancelShare() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  uploadTorrent() {\r\n    //upload torrent to server\r\n    let torrent = this.torrent;\r\n    let torrentFile = torrent.torrentFile.toString('base64');\r\n    let infoHash = torrent.infoHash;\r\n    let poster = this.poster;\r\n    let name = this.torrent.files[0].name\r\n    this.setState({ shareMsg: '文件上传中...' })\r\n    console.log('upload torrentFile' + torrentFile);\r\n    //TODO upload poster\r\n    let req = { torrentFile, infoHash, poster, name };\r\n    let exp = 1000 * 60 * 60 * 24;\r\n    let time = new Date().getTime()\r\n    time = time - (time % exp);\r\n    let signature = signString(this.userSec, infoHash + time);\r\n    let host = getFileHost()\r\n    //host = 'http://127.0.0.1:18080'\r\n    let url = host + '/torrentFile/' + infoHash + '/' + signature\r\n    let config = { url, nonce: '0000' }\r\n    postSafe(config, req, (res) => {\r\n      if (res) {\r\n        this.initResumable(infoHash, signature)\r\n        this.resume.addFile(this.html5File);\r\n      }\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    var account = loadLocalAccount();\r\n    if (account && account.secret) {\r\n      this.userSec = account.secret;\r\n      this.setState({ rsId: account.rsId })\r\n    }\r\n    this.share.init(this.onTorrentDone.bind(this), this.onTorrentStart.bind(this))\r\n  }\r\n\r\n  initResumable(infoHash, signature) {\r\n    let host = getFileHost()\r\n    // host = 'http://127.0.0.1:18080'\r\n    let target = host + '/share/' + infoHash + '/' + signature;\r\n    //console.log('target=' + target)\r\n    this.resume = new Resumable({\r\n      target,\r\n      chunkSize: 1 * 1024 * 1024,\r\n      simultaneousUploads: 4,\r\n      testChunks: false,\r\n      throttleProgressCallbacks: 1,\r\n      method: \"octet\"\r\n    });\r\n    //\r\n    this.resume.on('fileAdded', ((file) => {\r\n      console.log('resume got file ' + file)\r\n      if (this.resume)\r\n        this.resume.upload()\r\n      else {\r\n        console.log('this.resume is null')\r\n      }\r\n    }).bind(this))\r\n    this.resume.on('pause', function () {\r\n      console.log('resume pause')\r\n    });\r\n    this.resume.on('complete', () => {\r\n      console.log('resume complete')\r\n      this.setState({ shareMsg: '文件上传成功' })\r\n    });\r\n    this.resume.on('fileSuccess', (file, message) => {\r\n      console.log('resume fileSuccess')\r\n    });\r\n    this.resume.on('fileError', (file, message) => {\r\n      console.log('resume fileError')\r\n      this.setState({ shareMsg: '发布资源出错了', uploadAgain: true })\r\n    });\r\n    this.resume.on('fileProgress', (file) => {\r\n      let p = file.progress() * 100;\r\n      this.setState({ shareMsg: '文件上传中 ' + p + '%' })\r\n    });\r\n    this.resume.on('cancel', function () {\r\n      console.log('resume cancel')\r\n    });\r\n    this.resume.on('uploadStart', function () {\r\n      console.log('resume uploadStart')\r\n    });\r\n  }\r\n\r\n  prettyBytes(num) {\r\n    var exponent, unit, neg = num < 0, units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n    if (neg) num = -num\r\n    if (num < 1) return (neg ? '-' : '') + num + ' B'\r\n    exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1)\r\n    num = Number((num / Math.pow(1000, exponent)).toFixed(2))\r\n    unit = units[exponent]\r\n    return (neg ? '-' : '') + num + ' ' + unit\r\n  }\r\n\r\n  updateTorrentStatus() {\r\n    //console.log('size ' + this.torrentList.length)\r\n    this.torrentList.map((torrent) => {\r\n      //uploadSpeed peers\r\n      let peersSpan = document.querySelector('#pid' + torrent.infoHash);\r\n      if (peersSpan)\r\n        peersSpan.innerHTML = torrent.numPeers;\r\n      let speedSpan = document.querySelector('#sid' + torrent.infoHash);\r\n      if (speedSpan)\r\n        speedSpan.innerHTML = this.prettyBytes(torrent.uploadSpeed) + '/s';\r\n    })\r\n  }\r\n\r\n\r\n  onTorrentStart(html5Files) {\r\n    this.setState({ shareMsg: '处理中...(大文件可能会比较慢,请耐心等待)' })\r\n    if (html5Files) {\r\n      this.html5File = html5Files[0];\r\n    }\r\n  }\r\n\r\n  onTorrentDone(torrent) {\r\n    this.setState({ ready: true })\r\n    if (torrent) {\r\n      this.torrent = torrent;\r\n      var info = 'Torrent info hash: ' + torrent.infoHash +\r\n        'magnetURI=' + torrent.magnetURI +\r\n        ' torrentFileBlobURL=\"' + torrent.torrentFileBlobURL + 'name=' + torrent.name;\r\n      //console.log(info);\r\n      this.resId = torrent.infoHash\r\n      this.resName = torrent.name;\r\n      var rlist = this.state.resourceList;\r\n      rlist.push({ id: this.resId, name: this.resName })\r\n      this.setState({ resourceList: rlist })\r\n      torrent.key = torrent.infoHash;\r\n      //tags is not set yet\r\n      //torrent.tags = this.tags;\r\n      this.torrentList.unshift(torrent)\r\n      // torrentPoster(torrent, (err, buf, extension) => {\r\n      //   if (err) {\r\n      //     console.log(err)\r\n      //   } else {\r\n      //     // console.log('torrentPoster ' + err + ' ' + buf.toString('base64') + ' ext=' + extension)\r\n      //     this.poster = buf.toString('base64')\r\n      //   }\r\n      // })\r\n    }\r\n    if (!this.infoInterval) {\r\n      this.infoInterval = setInterval(this.updateTorrentStatus.bind(this), 3000);\r\n    }\r\n    this.setState({ shareMsg: '' })\r\n  }\r\n\r\n  updateSecret(e) {\r\n    if (e && e.target) {\r\n      this.userSec = e.target.value;\r\n      let rsId = calcAccountId(this.userSec);\r\n      this.setState({ rsId: rsId })\r\n    }\r\n  }\r\n\r\n  updateFee(e) {\r\n    if (e && e.target) {\r\n      this.fee = e.target.value;\r\n    }\r\n  }\r\n\r\n  updatePrice(e) {\r\n    if (e && e.target) {\r\n      this.price = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateTags(e) {\r\n    if (e && e.target) {\r\n      this.tags = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateDeadline(e) {\r\n    if (e && e.target) {\r\n      this.deadline = e.target.value;\r\n    }\r\n  }\r\n\r\n  renderAddFile() {\r\n    return (<Row>\r\n      <Col xs=\"12\">\r\n        <Fade>\r\n          <Card>\r\n            <CardHeader>\r\n              <i className=\"icon-share\" onClick={this.toggle.bind(this)}>流量矿工赚积分</i>\r\n              <div className=\"card-header-actions\">\r\n                <Button color=\"link\" className=\"card-header-action btn-setting\"><i className=\"icon-settings\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-minimize\" data-target=\"#collapseExample\" onClick={this.toggle.bind(this)}><i className=\"icon-arrow-up\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-close\" onClick={this.toggleFade}><i className=\"icon-close\"></i></Button>\r\n              </div>\r\n            </CardHeader>\r\n            <Collapse isOpen={this.state.collapse} id=\"collapseExample\">\r\n              <CardBody>\r\n                {/* <FormGroup>\r\n                  <Label htmlFor=\"appendedInputButtons\">账户密码:</Label>\r\n                  <div className=\"controls\">\r\n                    <InputGroup>\r\n                      <Input id=\"appendedInputButtons\" size=\"16\" type=\"text\" value={this.secret} onChange={this.updateSecret.bind(this)} placeholder='输入账户密码共享资源' />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup> */}\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>我的账号:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input id=\"prependedInput\" size=\"16\" type=\"text\" value={this.state.rsId} />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>本地资源:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <input name=\"upload\" type=\"file\"></input>\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n              </CardBody>\r\n            </Collapse>\r\n          </Card>\r\n        </Fade>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  renderUploadAgainButton() {\r\n    if (!this.state.uploadAgain)\r\n      return null\r\n    return (\r\n      <Button type=\"submit\" color=\"primary\" onClick={(e) => this.uploadAgain()}>重新上传</Button>\r\n    )\r\n  }\r\n\r\n\r\n\r\n  renderResourceItems() {\r\n    let items = this.state.resourceList.map((res) => {\r\n      let pid = 'pid' + res.id;\r\n      let sid = 'sid' + res.id;\r\n      let confirms = 0;\r\n      return (<ListGroupItem action>\r\n        <ListGroupItemHeading>{res.name}   <PopoverItem id={res.id} res={res} /></ListGroupItemHeading>\r\n        <ListGroupItemText>\r\n          <code> <span id={pid}></span>节点</code>. &#x2197;<code><span id={sid}></span>上传速度</code> <code><span id={sid}>{confirms}</span>个确认信息</code>\r\n        </ListGroupItemText>\r\n      </ListGroupItem>)\r\n    })\r\n    return items;\r\n  }\r\n\r\n  renderShareList() {\r\n    return (<Row>\r\n      <Col sm=\"12\" xl=\"6\">\r\n        <Card>\r\n          <CardHeader>\r\n            <i className=\"fa fa-align-justify\"></i><strong>资源列表</strong>\r\n            <Alert color=\"danger\"><small>流量矿工通过分享本机硬盘与网络流量为其他用户提供资源下载服务。其他用户成功下载资源后会留下确认信息，流量矿工用收集到的确认信息换取眞客积分。请不要刷新或关闭此页面，保持此页面打开状态下，网络上其他用户才可以下载资源</small></Alert>\r\n          </CardHeader>\r\n          <CardBody>\r\n            <ListGroup>\r\n              {this.renderResourceItems()}\r\n            </ListGroup>\r\n          </CardBody>\r\n        </Card>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        {this.renderAddFile()}\r\n        <div>\r\n          <Alert color=\"info\">{this.state.shareMsg}</Alert>\r\n        </div>\r\n        {this.renderShareList()}\r\n      </div>\r\n\r\n    );\r\n  }\r\n}\r\n\r\n\r\nclass PopoverItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.toggle = this.toggle.bind(this);\r\n    this.state = {\r\n      popoverOpen: false\r\n    };\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({\r\n      popoverOpen: !this.state.popoverOpen,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <span>\r\n        <span className='alert-primary  fade show' id={'Popover-' + this.props.id} onClick={this.toggle}>\r\n          (分享链接)\r\n          </span>\r\n        <Popover placement='top' isOpen={this.state.popoverOpen} target={'Popover-' + this.props.id} toggle={this.toggle}>\r\n          <PopoverHeader>分享这个资源的链接,获取更多确认信息</PopoverHeader>\r\n          <PopoverBody>{getCurrentHost() + \"/#/btb#\" + this.props.res.id + '#' + this.props.res.name}</PopoverBody>\r\n        </Popover>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport default WebMiner;\r\n"],"sourceRoot":""}