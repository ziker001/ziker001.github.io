{"version":3,"sources":["views/ggv/js/share.js","views/ggv/WebMiner/WebMiner.js"],"names":["WebTorrent","require","ShareManager","Object","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","client","tracker","rtcConfig","iceServers","urls","dht","torrentCallback","onStartCallback","uploadInput","up","document","querySelector","uploadElement","err","files","map","file","onFiles","bind","name","indexOf","isTorrentFile","torrent","on","warn","console","log","content","buf","Buffer","from","tor","seed","infoHash","_this","length","setTimeout","onSeedTorrent","forEach","elem","opts","cb","type","addEventListener","ev","reader","FileReader","index","results","read","readAsText","readAsDataURL","readAsArrayBuffer","e","push","target","Resumable","default","loadLocalAccount","postSafe","WebMiner","signString","props","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","state","collapse","resourceList","resource","tags","price","fee","deadline","owner","id","rsId","shareMsg","share","userSec","resName","resId","infoInterval","torrentList","resume","html5File","poster","setState","account","secret","init","onTorrentDone","onTorrentStart","signature","_this2","getFileHost","chunkSize","simultaneousUploads","testChunks","throttleProgressCallbacks","method","upload","message","uploadAgain","p","progress","num","exponent","neg","units","Math","min","floor","Number","pow","toFixed","_this3","peersSpan","innerHTML","numPeers","speedSpan","prettyBytes","uploadSpeed","html5Files","ready","magnetURI","torrentFileBlobURL","rlist","key","unshift","setInterval","updateTorrentStatus","value","calcAccountId","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","reactstrap__WEBPACK_IMPORTED_MODULE_7__","reactstrap__WEBPACK_IMPORTED_MODULE_8__","xs","reactstrap__WEBPACK_IMPORTED_MODULE_18__","reactstrap__WEBPACK_IMPORTED_MODULE_9__","reactstrap__WEBPACK_IMPORTED_MODULE_10__","className","onClick","toggle","reactstrap__WEBPACK_IMPORTED_MODULE_12__","color","data-target","toggleFade","reactstrap__WEBPACK_IMPORTED_MODULE_19__","isOpen","reactstrap__WEBPACK_IMPORTED_MODULE_11__","reactstrap__WEBPACK_IMPORTED_MODULE_20__","reactstrap__WEBPACK_IMPORTED_MODULE_13__","reactstrap__WEBPACK_IMPORTED_MODULE_14__","addonType","reactstrap__WEBPACK_IMPORTED_MODULE_15__","reactstrap__WEBPACK_IMPORTED_MODULE_16__","size","_this4","res","pid","sid","reactstrap__WEBPACK_IMPORTED_MODULE_21__","action","reactstrap__WEBPACK_IMPORTED_MODULE_22__","PopoverItem","reactstrap__WEBPACK_IMPORTED_MODULE_23__","sm","xl","reactstrap__WEBPACK_IMPORTED_MODULE_17__","reactstrap__WEBPACK_IMPORTED_MODULE_24__","renderResourceItems","renderAddFile","renderShareList","Component","_this5","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_0__","popoverOpen","reactstrap__WEBPACK_IMPORTED_MODULE_25__","placement","reactstrap__WEBPACK_IMPORTED_MODULE_26__","reactstrap__WEBPACK_IMPORTED_MODULE_27__","getCurrentHost"],"mappings":"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","file":"static/js/15.27aa66e1.chunk.js","sourcesContent":["const WebTorrent = require('flycat-torrent')\r\n\r\nexport default class ShareManager {\r\n\r\n    constructor() {\r\n        let rtcConfig = {\r\n            \"iceServers\": [\r\n                { \"urls\": \"stun:stun2.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun3.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun.btbresource.com:3478\" },\r\n                {\r\n                    \"urls\": \"stun:global.stun.twilio.com:3478?transport=udp\"\r\n                }\r\n            ]\r\n        };\r\n        this.client = new WebTorrent({\r\n            tracker: {\r\n                rtcConfig: rtcConfig\r\n            },\r\n            dht: false\r\n        })\r\n        this.torrentCallback = null\r\n        this.onStartCallback = null\r\n    }\r\n\r\n    init(torrentCallback, onStartCallback, uploadInput) {\r\n        this.torrentCallback = torrentCallback;\r\n        this.onStartCallback = onStartCallback;\r\n        var up = uploadInput;\r\n        if (!up)\r\n            up = document.querySelector('input[name=upload]')\r\n        if (up) {\r\n            this.uploadElement(up, this.onStartCallback, (function (err, files) {\r\n                if (err) return err;\r\n                files = files.map(function (file) { return file.file })\r\n                this.onFiles(files)\r\n            }).bind(this))\r\n        }\r\n    }\r\n\r\n    isTorrentFile(file) {\r\n        //var extname = path.extname(file.name).toLowerCase()\r\n        return file.name.indexOf('.torrent') !== -1;\r\n    }\r\n\r\n    isNotTorrentFile(file) {\r\n        return !this.isTorrentFile(file)\r\n    }\r\n\r\n    onSeedTorrent(torrent) {\r\n        torrent.on('warning', function (warn) {\r\n            console.log(warn);\r\n        })\r\n        torrent.on('error', function (err) {\r\n            console.log(err);\r\n        })\r\n        this.torrentCallback(torrent);\r\n    }\r\n\r\n    seedContent(content,torrentCallback) {\r\n        let buf = Buffer.from(content)\r\n        let tor = this.client.seed(buf, torrentCallback);\r\n        tor.on('infoHash', (infoHash) => {\r\n            torrentCallback(tor);\r\n        })\r\n    }\r\n\r\n    seed(files) {\r\n        if (files.length === 0) return\r\n        //console.log('Seeding ' + files.length + ' files')\r\n        this.onStartCallback(files)\r\n        // Seed from WebTorrent\r\n        setTimeout(() => {\r\n            let tor = this.client.seed(files, this.onSeedTorrent.bind(this));\r\n            tor.on('infoHash', (infoHash) => {\r\n                this.torrentCallback(tor);\r\n            })\r\n        }, 1000);\r\n    }\r\n    //\r\n    onFiles(files) {\r\n        console.log('got files:')\r\n        files.forEach(function (file) {\r\n            // console.log(' - %s (%s bytes)', file.name, file.size)\r\n        })\r\n\r\n        // .torrent file = start downloading the torrent\r\n        //files.filter(isTorrentFile).forEach(downloadTorrentFile)\r\n\r\n        // everything else = seed these files\r\n        this.seed(files)\r\n    }\r\n\r\n    uploadElement(elem, onStartCallback, opts, cb) {\r\n        if (typeof opts === 'function') {\r\n            cb = opts;\r\n            opts = {};\r\n        }\r\n        if (typeof opts === 'string') opts = { type: opts };\r\n\r\n        elem.addEventListener('change', function (ev) {\r\n            if (elem.files.length === 0) return cb(null, []);\r\n            if (onStartCallback)\r\n                onStartCallback(null)\r\n            var reader = new FileReader();\r\n            var index = 0;\r\n            var results = [];\r\n\r\n            reader.addEventListener('load', function (e) {\r\n                results.push({\r\n                    file: elem.files[index],\r\n                    target: e.target\r\n                });\r\n                index++;\r\n                if (index === elem.files.length) cb(null, results)\r\n                else read(index)\r\n            });\r\n            read(index);\r\n\r\n            function read(index) {\r\n                var file = elem.files[index];\r\n                if (opts.type === 'text') {\r\n                    reader.readAsText(file);\r\n                }\r\n                else if (opts.type === 'url') {\r\n                    reader.readAsDataURL(file);\r\n                }\r\n                else reader.readAsArrayBuffer(file);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n","import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Pagination, PaginationItem, PaginationLink, Row, Table } from 'reactstrap';\r\nimport { Button, Input, InputGroup, InputGroupAddon, InputGroupText, Alert } from 'reactstrap';\r\nimport { CardGroup, Container, Form, FormGroup, Fade, Collapse, Label, ListGroup, ListGroupItem, ListGroupItemHeading, ListGroupItemText } from 'reactstrap'\r\nimport { Modal, ModalBody, ModalFooter, ModalHeader, Popover, PopoverBody, PopoverHeader } from 'reactstrap'\r\nimport { getFileHost, calcAccountId, getCurrentHost } from '../js/gegeUtil.js'\r\nconst Resumable = require('resumablejs')\r\nconst ShareManager = require('../js/share').default\r\nconst { postSafe, loadLocalAccount, signString } = require('../js/gegeUtil')\r\nclass WebMiner extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    let res = { tags: '', price: '', fee: '', deadline: '', owner: '', id: '' }\r\n    this.state = { collapse: true, resourceList: [], resource: res, rsId: '' }\r\n    this.state.shareMsg = '';\r\n    this.share = new ShareManager();\r\n    this.userSec = ''\r\n    this.fee = 0.01;\r\n    this.deadline = 5;\r\n    this.price = 0;\r\n    this.tags = ''\r\n    this.resName = ''\r\n    this.resId = ''\r\n    this.infoInterval = null\r\n    this.torrentList = []\r\n    this.resume = null;\r\n    this.html5File = null;\r\n    this.torrent = null;\r\n    this.poster = null;\r\n  }\r\n\r\n  cancelShare() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({ collapse: !this.state.collapse });\r\n  }\r\n\r\n  componentDidMount() {\r\n    var account = loadLocalAccount();\r\n    if (account && account.secret) {\r\n      this.userSec = account.secret;\r\n      this.setState({ rsId: account.rsId })\r\n    }\r\n    this.share.init(this.onTorrentDone.bind(this), this.onTorrentStart.bind(this))\r\n  }\r\n\r\n  initResumable(infoHash, signature) {\r\n    let host = getFileHost()\r\n    // host = 'http://127.0.0.1:18080'\r\n    let target = host + '/share/' + infoHash + '/' + signature;\r\n    //console.log('target=' + target)\r\n    this.resume = new Resumable({\r\n      target,\r\n      chunkSize: 1 * 1024 * 1024,\r\n      simultaneousUploads: 4,\r\n      testChunks: false,\r\n      throttleProgressCallbacks: 1,\r\n      method: \"octet\"\r\n    });\r\n    //\r\n    this.resume.on('fileAdded', ((file) => {\r\n      console.log('resume got file ' + file)\r\n      if (this.resume)\r\n        this.resume.upload()\r\n      else {\r\n        console.log('this.resume is null')\r\n      }\r\n    }).bind(this))\r\n    this.resume.on('pause', function () {\r\n      console.log('resume pause')\r\n    });\r\n    this.resume.on('complete', () => {\r\n      console.log('resume complete')\r\n      this.setState({ shareMsg: '文件上传成功' })\r\n    });\r\n    this.resume.on('fileSuccess', (file, message) => {\r\n      console.log('resume fileSuccess')\r\n    });\r\n    this.resume.on('fileError', (file, message) => {\r\n      console.log('resume fileError')\r\n      this.setState({ shareMsg: '发布资源出错了', uploadAgain: true })\r\n    });\r\n    this.resume.on('fileProgress', (file) => {\r\n      let p = file.progress() * 100;\r\n      this.setState({ shareMsg: '文件上传中 ' + p + '%' })\r\n    });\r\n    this.resume.on('cancel', function () {\r\n      console.log('resume cancel')\r\n    });\r\n    this.resume.on('uploadStart', function () {\r\n      console.log('resume uploadStart')\r\n    });\r\n  }\r\n\r\n  prettyBytes(num) {\r\n    var exponent, unit, neg = num < 0, units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n    if (neg) num = -num\r\n    if (num < 1) return (neg ? '-' : '') + num + ' B'\r\n    exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1)\r\n    num = Number((num / Math.pow(1000, exponent)).toFixed(2))\r\n    unit = units[exponent]\r\n    return (neg ? '-' : '') + num + ' ' + unit\r\n  }\r\n\r\n  updateTorrentStatus() {\r\n    //console.log('size ' + this.torrentList.length)\r\n    this.torrentList.map((torrent) => {\r\n      //uploadSpeed peers\r\n      let peersSpan = document.querySelector('#pid' + torrent.infoHash);\r\n      if (peersSpan)\r\n        peersSpan.innerHTML = torrent.numPeers;\r\n      let speedSpan = document.querySelector('#sid' + torrent.infoHash);\r\n      if (speedSpan)\r\n        speedSpan.innerHTML = this.prettyBytes(torrent.uploadSpeed) + '/s';\r\n    })\r\n  }\r\n\r\n\r\n  onTorrentStart(html5Files) {\r\n    this.setState({ shareMsg: '处理中...(大文件可能会比较慢,请耐心等待)' })\r\n    if (html5Files) {\r\n      this.html5File = html5Files[0];\r\n    }\r\n  }\r\n\r\n  onTorrentDone(torrent) {\r\n    this.setState({ ready: true })\r\n    if (torrent) {\r\n      this.torrent = torrent;\r\n      var info = 'Torrent info hash: ' + torrent.infoHash +\r\n        'magnetURI=' + torrent.magnetURI +\r\n        ' torrentFileBlobURL=\"' + torrent.torrentFileBlobURL + 'name=' + torrent.name;\r\n      //console.log(info);\r\n      this.resId = torrent.infoHash\r\n      this.resName = torrent.name;\r\n      var rlist = this.state.resourceList;\r\n      rlist.push({ id: this.resId, name: this.resName })\r\n      this.setState({ resourceList: rlist })\r\n      torrent.key = torrent.infoHash;\r\n      //tags is not set yet\r\n      //torrent.tags = this.tags;\r\n      this.torrentList.unshift(torrent)\r\n      // torrentPoster(torrent, (err, buf, extension) => {\r\n      //   if (err) {\r\n      //     console.log(err)\r\n      //   } else {\r\n      //     // console.log('torrentPoster ' + err + ' ' + buf.toString('base64') + ' ext=' + extension)\r\n      //     this.poster = buf.toString('base64')\r\n      //   }\r\n      // })\r\n    }\r\n    if (!this.infoInterval) {\r\n      this.infoInterval = setInterval(this.updateTorrentStatus.bind(this), 3000);\r\n    }\r\n    this.setState({ shareMsg: '' })\r\n  }\r\n\r\n  updateSecret(e) {\r\n    if (e && e.target) {\r\n      this.userSec = e.target.value;\r\n      let rsId = calcAccountId(this.userSec);\r\n      this.setState({ rsId: rsId })\r\n    }\r\n  }\r\n\r\n  updateFee(e) {\r\n    if (e && e.target) {\r\n      this.fee = e.target.value;\r\n    }\r\n  }\r\n\r\n  updatePrice(e) {\r\n    if (e && e.target) {\r\n      this.price = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateTags(e) {\r\n    if (e && e.target) {\r\n      this.tags = e.target.value;\r\n    }\r\n  }\r\n\r\n  updateDeadline(e) {\r\n    if (e && e.target) {\r\n      this.deadline = e.target.value;\r\n    }\r\n  }\r\n\r\n  renderAddFile() {\r\n    return (<Row>\r\n      <Col xs=\"12\">\r\n        <Fade>\r\n          <Card>\r\n            <CardHeader>\r\n              <i className=\"icon-share\" onClick={this.toggle.bind(this)}>流量矿工赚积分</i>\r\n              <div className=\"card-header-actions\">\r\n                <Button color=\"link\" className=\"card-header-action btn-setting\"><i className=\"icon-settings\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-minimize\" data-target=\"#collapseExample\" onClick={this.toggle.bind(this)}><i className=\"icon-arrow-up\"></i></Button>\r\n                <Button color=\"link\" className=\"card-header-action btn-close\" onClick={this.toggleFade}><i className=\"icon-close\"></i></Button>\r\n              </div>\r\n            </CardHeader>\r\n            <Collapse isOpen={this.state.collapse} id=\"collapseExample\">\r\n              <CardBody>\r\n                {/* <FormGroup>\r\n                  <Label htmlFor=\"appendedInputButtons\">账户密码:</Label>\r\n                  <div className=\"controls\">\r\n                    <InputGroup>\r\n                      <Input id=\"appendedInputButtons\" size=\"16\" type=\"text\" value={this.secret} onChange={this.updateSecret.bind(this)} placeholder='输入账户密码共享资源' />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup> */}\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>我的账号:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input id=\"prependedInput\" size=\"16\" type=\"text\" value={this.state.rsId} />\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n                <FormGroup>\r\n                  <div className=\"controls\">\r\n                    <InputGroup className=\"input-prepend\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>本地资源:</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <input name=\"upload\" type=\"file\"></input>\r\n                    </InputGroup>\r\n                  </div>\r\n                </FormGroup>\r\n              </CardBody>\r\n            </Collapse>\r\n          </Card>\r\n        </Fade>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  renderUploadAgainButton() {\r\n    if (!this.state.uploadAgain)\r\n      return null\r\n    return (\r\n      <Button type=\"submit\" color=\"primary\" onClick={(e) => this.uploadAgain()}>重新上传</Button>\r\n    )\r\n  }\r\n\r\n\r\n\r\n  renderResourceItems() {\r\n    let items = this.state.resourceList.map((res) => {\r\n      let pid = 'pid' + res.id;\r\n      let sid = 'sid' + res.id;\r\n      let confirms = 0;\r\n      return (<ListGroupItem action>\r\n        <ListGroupItemHeading>{res.name}   <PopoverItem id={res.id} res={res} /></ListGroupItemHeading>\r\n        <ListGroupItemText>\r\n          <code> <span id={pid}></span>节点</code>. &#x2197;<code><span id={sid}></span>上传速度</code> <code><span id={sid}>{confirms}</span>个确认信息</code>\r\n        </ListGroupItemText>\r\n      </ListGroupItem>)\r\n    })\r\n    return items;\r\n  }\r\n\r\n  renderShareList() {\r\n    return (<Row>\r\n      <Col sm=\"12\" xl=\"6\">\r\n        <Card>\r\n          <CardHeader>\r\n            <i className=\"fa fa-align-justify\"></i><strong>资源列表</strong>\r\n            <Alert color=\"danger\"><small>流量矿工通过分享本机硬盘与网络流量为其他用户提供资源下载服务。其他用户成功下载资源后会留下确认信息，流量矿工用收集到的确认信息换取眞客积分。请不要刷新或关闭此页面，保持此页面打开状态下，网络上其他用户才可以下载资源</small></Alert>\r\n          </CardHeader>\r\n          <CardBody>\r\n            <ListGroup>\r\n              {this.renderResourceItems()}\r\n            </ListGroup>\r\n          </CardBody>\r\n        </Card>\r\n      </Col>\r\n    </Row>)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        {this.renderAddFile()}\r\n        <div>\r\n          <Alert color=\"info\">{this.state.shareMsg}</Alert>\r\n        </div>\r\n        {this.renderShareList()}\r\n      </div>\r\n\r\n    );\r\n  }\r\n}\r\n\r\n\r\nclass PopoverItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.toggle = this.toggle.bind(this);\r\n    this.state = {\r\n      popoverOpen: false\r\n    };\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({\r\n      popoverOpen: !this.state.popoverOpen,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <span>\r\n        <span className='alert-primary  fade show' id={'Popover-' + this.props.id} onClick={this.toggle}>\r\n          (分享链接)\r\n          </span>\r\n        <Popover placement='top' isOpen={this.state.popoverOpen} target={'Popover-' + this.props.id} toggle={this.toggle}>\r\n          <PopoverHeader>分享这个资源的链接,获取更多确认信息</PopoverHeader>\r\n          <PopoverBody>{getCurrentHost() + \"/#/btb#\" + this.props.res.id + '#' + this.props.res.name}</PopoverBody>\r\n        </Popover>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport default WebMiner;\r\n"],"sourceRoot":""}