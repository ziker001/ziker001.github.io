{"version":3,"sources":["views/ggv/js/share.js","../node_modules/reactstrap/es/ListGroupItemHeading.js","../node_modules/reactstrap/es/ListGroupItemText.js","views/ggv/FileTransfer/FileTransfer.js"],"names":["WebTorrent","require","ShareManager","Object","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","client","tracker","rtcConfig","iceServers","urls","dht","torrentCallback","onStartCallback","uploadInput","up","document","querySelector","uploadElement","err","files","map","file","onFiles","bind","name","indexOf","isTorrentFile","torrent","on","warn","console","log","content","buf","Buffer","from","tor","seed","infoHash","_this","length","setTimeout","onSeedTorrent","forEach","elem","opts","cb","type","addEventListener","ev","reader","FileReader","index","results","read","readAsText","readAsDataURL","readAsArrayBuffer","e","push","target","_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_babel_runtime_helpers_esm_objectWithoutPropertiesLoose__WEBPACK_IMPORTED_MODULE_1__","react__WEBPACK_IMPORTED_MODULE_2__","react__WEBPACK_IMPORTED_MODULE_2___default","n","prop_types__WEBPACK_IMPORTED_MODULE_3__","prop_types__WEBPACK_IMPORTED_MODULE_3___default","classnames__WEBPACK_IMPORTED_MODULE_4__","classnames__WEBPACK_IMPORTED_MODULE_4___default","_utils__WEBPACK_IMPORTED_MODULE_5__","propTypes","tag","className","a","any","cssModule","object","ListGroupItemHeading","props","Tag","attributes","classes","createElement","defaultProps","__webpack_exports__","ListGroupItemText","default","get","getCurrentHost","startPlayer","randombytes","FileTransfer","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","state","resourceList","download","loadingMsg","showqr","qrName","shareMsg","share","tags","resName","resId","infoInterval","torrentList","hash","window","location","query","idx","substr","idx2","setState","startDownload","init","onTorrentDone","onTorrentStart","secret","url","getShareHost","concat","json","r","data","ok","toString","id","num","exponent","neg","units","Math","min","floor","Number","pow","toFixed","_this2","peersSpan","speedSpan","innerHTML","numPeers","prettyBytes","uploadSpeed","magnetURI","torrentFileBlobURL","rlist","key","unshift","setInterval","updateTorrentStatus","react__WEBPACK_IMPORTED_MODULE_5___default","reactstrap__WEBPACK_IMPORTED_MODULE_6__","reactstrap__WEBPACK_IMPORTED_MODULE_7__","xs","reactstrap__WEBPACK_IMPORTED_MODULE_17__","reactstrap__WEBPACK_IMPORTED_MODULE_8__","reactstrap__WEBPACK_IMPORTED_MODULE_9__","reactstrap__WEBPACK_IMPORTED_MODULE_12__","color","reactstrap__WEBPACK_IMPORTED_MODULE_18__","isOpen","reactstrap__WEBPACK_IMPORTED_MODULE_10__","reactstrap__WEBPACK_IMPORTED_MODULE_19__","reactstrap__WEBPACK_IMPORTED_MODULE_13__","reactstrap__WEBPACK_IMPORTED_MODULE_14__","addonType","reactstrap__WEBPACK_IMPORTED_MODULE_15__","reactstrap__WEBPACK_IMPORTED_MODULE_16__","showQRDialog","resid","addr","focus","select","successful","execCommand","msg","_this3","res","pid","sid","reactstrap__WEBPACK_IMPORTED_MODULE_20__","action","reactstrap__WEBPACK_IMPORTED_MODULE_21__","onClick","showBarcode","copyAddress","readOnly","style","width","value","reactstrap__WEBPACK_IMPORTED_MODULE_22__","sm","xl","reactstrap__WEBPACK_IMPORTED_MODULE_23__","renderResourceItems","reactstrap__WEBPACK_IMPORTED_MODULE_24__","reactstrap__WEBPACK_IMPORTED_MODULE_25__","toggle","reactstrap__WEBPACK_IMPORTED_MODULE_26__","reactstrap__WEBPACK_IMPORTED_MODULE_11__","renderPlayer","renderAddFile","renderShareList","Component"],"mappings":"uKAAMA,EAAaC,EAAQ,KAENC,aAEjB,SAAAA,IAAeC,OAAAC,EAAA,EAAAD,CAAAE,KAAAH,GAWXG,KAAKC,OAAS,IAAIN,EAAW,CACzBO,QAAS,CACLC,UAZQ,CACZC,WAAc,CACV,CAAEC,KAAQ,iCACV,CAAEA,KAAQ,iCACV,CAAEA,KAAQ,kCACV,CACIA,KAAQ,qDAQhBC,KAAK,IAETN,KAAKO,gBAAkB,KACvBP,KAAKQ,gBAAkB,sDAGtBD,EAAiBC,EAAiBC,GACnCT,KAAKO,gBAAkBA,EACvBP,KAAKQ,gBAAkBA,EACvB,IAAIE,EAAKD,EACJC,IACDA,EAAKC,SAASC,cAAc,uBAC5BF,GACAV,KAAKa,cAAcH,EAAIV,KAAKQ,gBAAkB,SAAUM,EAAKC,GACzD,GAAID,EAAK,OAAOA,EAChBC,EAAQA,EAAMC,IAAI,SAAUC,GAAQ,OAAOA,EAAKA,OAChDjB,KAAKkB,QAAQH,IACdI,KAAKnB,6CAIFiB,GAEV,OAA0C,IAAnCA,EAAKG,KAAKC,QAAQ,qDAGZJ,GACb,OAAQjB,KAAKsB,cAAcL,yCAGjBM,GACVA,EAAQC,GAAG,UAAW,SAAUC,GAC5BC,QAAQC,IAAIF,KAEhBF,EAAQC,GAAG,QAAS,SAAUV,GAC1BY,QAAQC,IAAIb,KAEhBd,KAAKO,gBAAgBgB,uCAGbK,EAAQrB,GAChB,IAAIsB,EAAMC,EAAOC,KAAKH,GAClBI,EAAMhC,KAAKC,OAAOgC,KAAKJ,EAAKtB,GAChCyB,EAAIR,GAAG,WAAY,SAACU,GAChB3B,EAAgByB,kCAInBjB,GAAO,IAAAoB,EAAAnC,KACa,IAAjBe,EAAMqB,SAEVpC,KAAKQ,gBAAgBO,GAErBsB,WAAW,WACP,IAAIL,EAAMG,EAAKlC,OAAOgC,KAAKlB,EAAOoB,EAAKG,cAAcnB,KAAKgB,IAC1DH,EAAIR,GAAG,WAAY,SAACU,GAChBC,EAAK5B,gBAAgByB,MAE1B,sCAGCjB,GACJW,QAAQC,IAAI,cACZZ,EAAMwB,QAAQ,SAAUtB,MAQxBjB,KAAKiC,KAAKlB,yCAGAyB,EAAMhC,EAAiBiC,EAAMC,GACnB,oBAATD,IACPC,EAAKD,EACLA,EAAO,IAES,kBAATA,IAAmBA,EAAO,CAAEE,KAAMF,IAE7CD,EAAKI,iBAAiB,SAAU,SAAUC,GACtC,GAA0B,IAAtBL,EAAKzB,MAAMqB,OAAc,OAAOM,EAAG,KAAM,IACzClC,GACAA,EAAgB,MACpB,IAAIsC,EAAS,IAAIC,WACbC,EAAQ,EACRC,EAAU,GAad,SAASC,EAAKF,GACV,IAAI/B,EAAOuB,EAAKzB,MAAMiC,GACJ,SAAdP,EAAKE,KACLG,EAAOK,WAAWlC,GAEC,QAAdwB,EAAKE,KACVG,EAAOM,cAAcnC,GAEpB6B,EAAOO,kBAAkBpC,GAnBlC6B,EAAOF,iBAAiB,OAAQ,SAAUU,GACtCL,EAAQM,KAAK,CACTtC,KAAMuB,EAAKzB,MAAMiC,GACjBQ,OAAQF,EAAEE,WAEdR,IACcR,EAAKzB,MAAMqB,OAAQM,EAAG,KAAMO,GACrCC,EAAKF,KAEdE,EAAKF,wECrHjB,IAAAS,EAAAC,EAAA,GAAAC,EAAAD,EAAA,GAAAE,EAAAF,EAAA,GAAAG,EAAAH,EAAAI,EAAAF,GAAAG,EAAAL,EAAA,GAAAM,EAAAN,EAAAI,EAAAC,GAAAE,EAAAP,EAAA,GAAAQ,EAAAR,EAAAI,EAAAG,GAAAE,EAAAT,EAAA,GAMAU,EAAA,CACAC,IAAOF,EAAA,EACPG,UAAaN,EAAAO,EAASC,IACtBC,UAAaT,EAAAO,EAASG,QAMtBC,EAAA,SAAAC,GACA,IAAAN,EAAAM,EAAAN,UACAG,EAAAG,EAAAH,UACAI,EAAAD,EAAAP,IACAS,EAAmBhF,OAAA6D,EAAA,EAAA7D,CAA6B8E,EAAA,iCAEhDG,EAAgBjF,OAAAqE,EAAA,EAAArE,CAAgBoE,IAAUI,EAAA,2BAAAG,GAC1C,OAASZ,EAAAU,EAAKS,cAAAH,EAAoB/E,OAAA2D,EAAA,EAAA3D,CAAQ,GAAGgF,EAAA,CAC7CR,UAAAS,MAIAJ,EAAAP,YACAO,EAAAM,aAjBA,CACAZ,IAAA,MAiBea,EAAA,sCC7Bf,IAAAzB,EAAAC,EAAA,GAAAC,EAAAD,EAAA,GAAAE,EAAAF,EAAA,GAAAG,EAAAH,EAAAI,EAAAF,GAAAG,EAAAL,EAAA,GAAAM,EAAAN,EAAAI,EAAAC,GAAAE,EAAAP,EAAA,GAAAQ,EAAAR,EAAAI,EAAAG,GAAAE,EAAAT,EAAA,GAMAU,EAAA,CACAC,IAAOF,EAAA,EACPG,UAAaN,EAAAO,EAASC,IACtBC,UAAaT,EAAAO,EAASG,QAMtBS,EAAA,SAAAP,GACA,IAAAN,EAAAM,EAAAN,UACAG,EAAAG,EAAAH,UACAI,EAAAD,EAAAP,IACAS,EAAmBhF,OAAA6D,EAAA,EAAA7D,CAA6B8E,EAAA,iCAEhDG,EAAgBjF,OAAAqE,EAAA,EAAArE,CAAgBoE,IAAUI,EAAA,wBAAAG,GAC1C,OAASZ,EAAAU,EAAKS,cAAAH,EAAoB/E,OAAA2D,EAAA,EAAA3D,CAAQ,GAAGgF,EAAA,CAC7CR,UAAAS,MAIAI,EAAAf,YACAe,EAAAF,aAjBA,CACAZ,IAAA,KAiBea,EAAA,wSCvBTrF,EAAeD,EAAQ,KAAewF,QACtCC,EAAMzF,EAAQ,MACoBA,EAAQ,IAAxC0F,mBAAgBC,gBACpBC,EAAc5F,EAAQ,IAEpB6F,cAEF,SAAAA,EAAYb,GAAO,IAAAzC,EAAA,OAAArC,OAAAC,EAAA,EAAAD,CAAAE,KAAAyF,IACftD,EAAArC,OAAA4F,EAAA,EAAA5F,CAAAE,KAAAF,OAAA6F,EAAA,EAAA7F,CAAA2F,GAAAG,KAAA5F,KAAM4E,KACDiB,MAAQ,CAAEC,aAAc,GAAIC,SAAU,KAAMC,WAAY,2BAAaC,QAAQ,EAAOC,OAAQ,IACjG/D,EAAK0D,MAAMM,SAAW,GACtBhE,EAAKiE,MAAQ,IAAIvG,EAAasC,EAAK0D,OAOnC1D,EAAKkE,KAAO,GACZlE,EAAKmE,QAAU,GACfnE,EAAKoE,MAAQ,GACbpE,EAAKqE,aAAe,KACpBrE,EAAKsE,YAAc,GAfJtE,mFAoBf,IAAIuE,EAAOC,OAAOC,SAASF,KACvBG,EAAQ,KACRzF,EAAO,KACX,GAAIsF,EAAM,CACN,IAAII,EAAMJ,EAAKrF,QAAQ,IAAK,GAC5B,GAAIyF,EAAM,EAAG,CAETD,EAAQH,EAAKK,OAAOD,EAAM,EAAG,IAC7B,IAAIE,EAAON,EAAKrF,QAAQ,IAAKyF,EAAM,IAC3BE,EAAO,IACP5F,EAAOsF,EAAKK,OAAOC,EAAO,IAI9BH,GAAyB,IAAhBA,EAAMzE,SACXhB,EAEApB,KAAKiH,SAAS,CAAElB,SAAU3E,IAE1BpB,KAAKiH,SAAS,CAAElB,SAAUc,IAE9B7G,KAAKkH,cAAc,KAAML,KAIrC7G,KAAKoG,MAAMe,KAAKnH,KAAKoH,cAAcjG,KAAKnB,MAAOA,KAAKqH,eAAelG,KAAKnB,6CAG9DsH,EAAQf,GAClB,IAAIgB,EAAMC,yBAAiB,iCAAmCjB,EAE9DlB,EAAIoC,OAAO,CAAEF,IAAKA,EAAKG,MAAM,GAAS,SAAU5G,EAAK6G,EAAGC,GACpD,GAAI9G,EAEAd,KAAKiH,SAAS,CAAEd,SAAU,gCAG9B,GAAIyB,EAAKC,GAAI,CAEgBrC,EAAY,IAAIsC,SAAS,OAClDvC,EAAY+B,EAAQ,CAAES,GAAIxB,EAAOF,KAAM,UAEvCrG,KAAKiH,SAAS,CAAEd,SAAU,0CAE/BhF,KAAKnB,2CAGAgI,GACR,IAAIC,EAAgBC,EAAMF,EAAM,EAAGG,EAAQ,CAAC,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAE3F,OADID,IAAKF,GAAOA,GACZA,EAAM,GAAWE,EAAM,IAAM,IAAMF,EAAM,MAC7CC,EAAWG,KAAKC,IAAID,KAAKE,MAAMF,KAAKzG,IAAIqG,GAAOI,KAAKzG,IAAI,MAAQwG,EAAM/F,OAAS,IAGvE8F,EAAM,IAAM,KAFpBF,EAAMO,QAAQP,EAAMI,KAAKI,IAAI,IAAMP,IAAWQ,QAAQ,KAEtB,IADzBN,EAAMF,kDAIK,IAAAS,EAAA1I,KAElBA,KAAKyG,YAAYzF,IAAI,SAACO,GAElB,IAAIoH,EAAYhI,SAASC,cAAc,OAASW,EAAQW,UACpD0G,EAAYjI,SAASC,cAAc,OAASW,EAAQW,UACpDyG,IACAA,EAAUE,UAAYtH,EAAQuH,UAC9BF,IACAA,EAAUC,UAAYH,EAAKK,YAAYxH,EAAQyH,aAAe,iDAKtEhJ,KAAKiH,SAAS,CAAEd,SAAU,gEAGhB5E,GACV,GAAIA,EAAS,CAC0BA,EAAQW,SACxBX,EAAQ0H,UACG1H,EAAQ2H,mBAA+B3H,EAAQH,KAE7EpB,KAAKuG,MAAQhF,EAAQW,SACrBlC,KAAKsG,QAAU/E,EAAQH,KACvB,IAAI+H,EAAQnJ,KAAK6F,MAAMC,aACvBqD,EAAM5F,KAAK,CAAEwE,GAAI/H,KAAKuG,MAAOnF,KAAMpB,KAAKsG,UACxCtG,KAAKiH,SAAS,CAAEnB,aAAcqD,IAC9B5H,EAAQ6H,IAAM7H,EAAQW,SAGtBlC,KAAKyG,YAAY4C,QAAQ9H,GAExBvB,KAAKwG,eACNxG,KAAKwG,aAAe8C,YAAYtJ,KAAKuJ,oBAAoBpI,KAAKnB,MAAO,MAEzEA,KAAKiH,SAAS,CAAEd,SAAU,6CAK1B,OAAQqD,EAAAjF,EAAAS,cAACyE,EAAA,EAAD,KACJD,EAAAjF,EAAAS,cAAC0E,EAAA,EAAD,CAAKC,GAAG,MACJH,EAAAjF,EAAAS,cAAC4E,EAAA,EAAD,KACIJ,EAAAjF,EAAAS,cAAC6E,EAAA,EAAD,KACIL,EAAAjF,EAAAS,cAAC8E,EAAA,EAAD,KACIN,EAAAjF,EAAAS,cAAA,KAAGV,UAAU,cAAb,8CACAkF,EAAAjF,EAAAS,cAAA,OAAKV,UAAU,uBACXkF,EAAAjF,EAAAS,cAAC+E,EAAA,EAAD,CAAQC,MAAM,OAAO1F,UAAU,kCAAiCkF,EAAAjF,EAAAS,cAAA,KAAGV,UAAU,qBAGrFkF,EAAAjF,EAAAS,cAACiF,EAAA,EAAD,CAAUC,QAAQ,EAAMnC,GAAG,mBACvByB,EAAAjF,EAAAS,cAACmF,EAAA,EAAD,KACIX,EAAAjF,EAAAS,cAAA,WACIwE,EAAAjF,EAAAS,cAAA,0MAEJwE,EAAAjF,EAAAS,cAACoF,EAAA,EAAD,KACIZ,EAAAjF,EAAAS,cAAA,OAAKV,UAAU,YACXkF,EAAAjF,EAAAS,cAACqF,EAAA,EAAD,CAAY/F,UAAU,iBAClBkF,EAAAjF,EAAAS,cAACsF,EAAA,EAAD,CAAiBC,UAAU,WACvBf,EAAAjF,EAAAS,cAACwF,EAAA,EAAD,iCAEJhB,EAAAjF,EAAAS,cAAA,SAAO5D,KAAK,SAASuB,KAAK,YAItC6G,EAAAjF,EAAAS,cAAA,WACIwE,EAAAjF,EAAAS,cAAA,SAAGwE,EAAAjF,EAAAS,cAACyF,EAAA,EAAD,CAAOT,MAAM,UAASR,EAAAjF,EAAAS,cAAA,aAAQhF,KAAK6F,MAAMM,uDAUhEI,EAAOD,GACftG,KAAKiH,SAAS,CAAEhB,QAAQ,EAAMC,OAAQI,IACtC,IAAIiB,EAAMjC,IAAmB,UAAYiB,EAAQ,IAAMD,EACvDjE,WAAW,WACPqI,uBAAanD,IACd,0CAGKoD,GACR,IAAIC,EAAOjK,SAASC,cAAc,QAAU+J,GAC5CC,EAAKC,QACLD,EAAKE,SACL,IAAIC,EAAapK,SAASqK,YAAY,QAClCC,EAAMtK,SAASC,cAAc,QAAU+J,GAEvCM,EAAIpC,UADJkC,EACgB,8BAEA,6GAIF,IAAAG,EAAAlL,KAiBlB,OAhBYA,KAAK6F,MAAMC,aAAa9E,IAAI,SAACmK,GACrC,IAAIC,EAAM,MAAQD,EAAIpD,GAClBsD,EAAM,MAAQF,EAAIpD,GACtB,OAAQyB,EAAAjF,EAAAS,cAACsG,EAAA,EAAD,CAAelC,IAAK+B,EAAIpD,GAAIwD,QAAM,GACtC/B,EAAAjF,EAAAS,cAACwG,EAAA,EAAD,SAAuBhC,EAAAjF,EAAAS,cAAA,KAAGV,UAAU,gBAAgBmH,QAAS,SAACnI,GAAD,OAAO4H,EAAKQ,YAAYP,EAAIpD,GAAIoD,EAAI/J,SAAWoI,EAAAjF,EAAAS,cAAA,gBAAQmG,EAAI/J,KAAZ,+EACxGoI,EAAAjF,EAAAS,cAAC+E,EAAA,EAAD,CAAQC,MAAM,gBAAgByB,QAAS,SAACnI,GAAD,OAAO4H,EAAKS,YAAYR,EAAIpD,MAC/DyB,EAAAjF,EAAAS,cAAA,KAAGV,UAAU,qBADjB,gCAGAkF,EAAAjF,EAAAS,cAAA,QAAMV,UAAU,gBAAgByD,GAAI,OAASoD,EAAIpD,MAErDyB,EAAAjF,EAAAS,cAACwG,EAAA,EAAD,KAAsBhC,EAAAjF,EAAAS,cAAA,SAAO4G,UAAQ,EAACC,MAAO,CAAEC,MAAO,QAAU/D,GAAI,OAASoD,EAAIpD,GAAIgE,MAAOzG,IAAmB,UAAY6F,EAAIpD,GAAK,IAAMoD,EAAI/J,QAC9IoI,EAAAjF,EAAAS,cAACgH,EAAA,EAAD,KACIxC,EAAAjF,EAAAS,cAAA,gBAAOwE,EAAAjF,EAAAS,cAAA,QAAM+C,GAAIqD,IAAjB,gBADJ,WACoD5B,EAAAjF,EAAAS,cAAA,YAAMwE,EAAAjF,EAAAS,cAAA,QAAM+C,GAAIsD,IAAhB,iEAQ5DrL,KAAKiH,SAAS,CAAEhB,QAASjG,KAAK6F,MAAMI,mDAIpC,OAAQuD,EAAAjF,EAAAS,cAACyE,EAAA,EAAD,KACJD,EAAAjF,EAAAS,cAAC0E,EAAA,EAAD,CAAKuC,GAAG,KAAKC,GAAG,KACZ1C,EAAAjF,EAAAS,cAAC6E,EAAA,EAAD,KACIL,EAAAjF,EAAAS,cAAC8E,EAAA,EAAD,KACIN,EAAAjF,EAAAS,cAAA,KAAGV,UAAU,wBAA0BkF,EAAAjF,EAAAS,cAAA,wDACvCwE,EAAAjF,EAAAS,cAACyF,EAAA,EAAD,CAAOT,MAAM,UAASR,EAAAjF,EAAAS,cAAA,4fAE1BwE,EAAAjF,EAAAS,cAACmF,EAAA,EAAD,KACIX,EAAAjF,EAAAS,cAACmH,EAAA,EAAD,KACKnM,KAAKoM,uBAEV5C,EAAAjF,EAAAS,cAACqH,EAAA,EAAD,CAAOnC,OAAQlK,KAAK6F,MAAMI,OAAQ3B,UAAWtE,KAAK4E,MAAMN,WACpDkF,EAAAjF,EAAAS,cAACsH,EAAA,EAAD,CAAaC,OAAQvM,KAAKuM,OAAOpL,KAAKnB,OAAQA,KAAK6F,MAAMK,QACzDsD,EAAAjF,EAAAS,cAACwH,EAAA,EAAD,KACIhD,EAAAjF,EAAAS,cAAA,OAAK+C,GAAG,wDAUhC,OAAK/H,KAAK6F,MAAME,SAGZyD,EAAAjF,EAAAS,cAAA,OAAK+C,GAAG,WACJyB,EAAAjF,EAAAS,cAAC6E,EAAA,EAAD,KACIL,EAAAjF,EAAAS,cAAC8E,EAAA,EAAD,KACK9J,KAAK6F,MAAME,SACZyD,EAAAjF,EAAAS,cAACyH,EAAA,EAAD,CAAOzC,MAAM,UAAU1F,UAAU,eAAetE,KAAK6F,MAAMG,aAE/DwD,EAAAjF,EAAAS,cAACmF,EAAA,EAAD,KACIX,EAAAjF,EAAAS,cAAA,OAAK+C,GAAG,UACJyB,EAAAjF,EAAAS,cAAA,WACIwE,EAAAjF,EAAAS,cAAA,QAAMV,UAAU,cAAhB,UACAkF,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,YAAT,WAFJ,IAGAyB,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,iBAAT,UAHA,YAIAyB,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,eAAT,YACIyB,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,eALb,MAMAyB,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,UANT,UAOAyB,EAAAjF,EAAAS,cAAA,QAAM+C,GAAG,gBAGbyB,EAAAjF,EAAAS,cAAA,OAAK+C,GAAG,SAAS8D,MAAO,CAAEC,MAAO,aApBtC,sCA8BX,OACItC,EAAAjF,EAAAS,cAAA,OAAKV,UAAU,mBACVtE,KAAK0M,eACL1M,KAAK2M,gBACL3M,KAAK4M,0BArQKC,aA6QZpH","file":"static/js/8.e6ae8cc5.chunk.js","sourcesContent":["const WebTorrent = require('flycat-torrent')\r\n\r\nexport default class ShareManager {\r\n\r\n    constructor() {\r\n        let rtcConfig = {\r\n            \"iceServers\": [\r\n                { \"urls\": \"stun:stun2.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun3.l.google.com:19302\" },\r\n                { \"urls\": \"stun:stun.btbresource.com:3478\" },\r\n                {\r\n                    \"urls\": \"stun:global.stun.twilio.com:3478?transport=udp\"\r\n                }\r\n            ]\r\n        };\r\n        this.client = new WebTorrent({\r\n            tracker: {\r\n                rtcConfig: rtcConfig\r\n            },\r\n            dht: false\r\n        })\r\n        this.torrentCallback = null\r\n        this.onStartCallback = null\r\n    }\r\n\r\n    init(torrentCallback, onStartCallback, uploadInput) {\r\n        this.torrentCallback = torrentCallback;\r\n        this.onStartCallback = onStartCallback;\r\n        var up = uploadInput;\r\n        if (!up)\r\n            up = document.querySelector('input[name=upload]')\r\n        if (up) {\r\n            this.uploadElement(up, this.onStartCallback, (function (err, files) {\r\n                if (err) return err;\r\n                files = files.map(function (file) { return file.file })\r\n                this.onFiles(files)\r\n            }).bind(this))\r\n        }\r\n    }\r\n\r\n    isTorrentFile(file) {\r\n        //var extname = path.extname(file.name).toLowerCase()\r\n        return file.name.indexOf('.torrent') !== -1;\r\n    }\r\n\r\n    isNotTorrentFile(file) {\r\n        return !this.isTorrentFile(file)\r\n    }\r\n\r\n    onSeedTorrent(torrent) {\r\n        torrent.on('warning', function (warn) {\r\n            console.log(warn);\r\n        })\r\n        torrent.on('error', function (err) {\r\n            console.log(err);\r\n        })\r\n        this.torrentCallback(torrent);\r\n    }\r\n\r\n    seedContent(content,torrentCallback) {\r\n        let buf = Buffer.from(content)\r\n        let tor = this.client.seed(buf, torrentCallback);\r\n        tor.on('infoHash', (infoHash) => {\r\n            torrentCallback(tor);\r\n        })\r\n    }\r\n\r\n    seed(files) {\r\n        if (files.length === 0) return\r\n        //console.log('Seeding ' + files.length + ' files')\r\n        this.onStartCallback(files)\r\n        // Seed from WebTorrent\r\n        setTimeout(() => {\r\n            let tor = this.client.seed(files, this.onSeedTorrent.bind(this));\r\n            tor.on('infoHash', (infoHash) => {\r\n                this.torrentCallback(tor);\r\n            })\r\n        }, 1000);\r\n    }\r\n    //\r\n    onFiles(files) {\r\n        console.log('got files:')\r\n        files.forEach(function (file) {\r\n            // console.log(' - %s (%s bytes)', file.name, file.size)\r\n        })\r\n\r\n        // .torrent file = start downloading the torrent\r\n        //files.filter(isTorrentFile).forEach(downloadTorrentFile)\r\n\r\n        // everything else = seed these files\r\n        this.seed(files)\r\n    }\r\n\r\n    uploadElement(elem, onStartCallback, opts, cb) {\r\n        if (typeof opts === 'function') {\r\n            cb = opts;\r\n            opts = {};\r\n        }\r\n        if (typeof opts === 'string') opts = { type: opts };\r\n\r\n        elem.addEventListener('change', function (ev) {\r\n            if (elem.files.length === 0) return cb(null, []);\r\n            if (onStartCallback)\r\n                onStartCallback(null)\r\n            var reader = new FileReader();\r\n            var index = 0;\r\n            var results = [];\r\n\r\n            reader.addEventListener('load', function (e) {\r\n                results.push({\r\n                    file: elem.files[index],\r\n                    target: e.target\r\n                });\r\n                index++;\r\n                if (index === elem.files.length) cb(null, results)\r\n                else read(index)\r\n            });\r\n            read(index);\r\n\r\n            function read(index) {\r\n                var file = elem.files[index];\r\n                if (opts.type === 'text') {\r\n                    reader.readAsText(file);\r\n                }\r\n                else if (opts.type === 'url') {\r\n                    reader.readAsDataURL(file);\r\n                }\r\n                else reader.readAsArrayBuffer(file);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { mapToCssModules, tagPropType } from './utils';\nvar propTypes = {\n  tag: tagPropType,\n  className: PropTypes.any,\n  cssModule: PropTypes.object\n};\nvar defaultProps = {\n  tag: 'h5'\n};\n\nvar ListGroupItemHeading = function ListGroupItemHeading(props) {\n  var className = props.className,\n      cssModule = props.cssModule,\n      Tag = props.tag,\n      attributes = _objectWithoutPropertiesLoose(props, [\"className\", \"cssModule\", \"tag\"]);\n\n  var classes = mapToCssModules(classNames(className, 'list-group-item-heading'), cssModule);\n  return React.createElement(Tag, _extends({}, attributes, {\n    className: classes\n  }));\n};\n\nListGroupItemHeading.propTypes = propTypes;\nListGroupItemHeading.defaultProps = defaultProps;\nexport default ListGroupItemHeading;","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { mapToCssModules, tagPropType } from './utils';\nvar propTypes = {\n  tag: tagPropType,\n  className: PropTypes.any,\n  cssModule: PropTypes.object\n};\nvar defaultProps = {\n  tag: 'p'\n};\n\nvar ListGroupItemText = function ListGroupItemText(props) {\n  var className = props.className,\n      cssModule = props.cssModule,\n      Tag = props.tag,\n      attributes = _objectWithoutPropertiesLoose(props, [\"className\", \"cssModule\", \"tag\"]);\n\n  var classes = mapToCssModules(classNames(className, 'list-group-item-text'), cssModule);\n  return React.createElement(Tag, _extends({}, attributes, {\n    className: classes\n  }));\n};\n\nListGroupItemText.propTypes = propTypes;\nListGroupItemText.defaultProps = defaultProps;\nexport default ListGroupItemText;","import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Row } from 'reactstrap';\r\nimport { Button, InputGroup, InputGroupAddon, InputGroupText, Alert } from 'reactstrap';\r\nimport { FormGroup, Fade, Collapse, ListGroup, ListGroupItem, ListGroupItemHeading, ListGroupItemText } from 'reactstrap'\r\nimport { Modal, ModalBody, ModalHeader } from 'reactstrap'\r\nimport { getShareHost, showQRDialog } from '../js/gegeUtil.js'\r\nconst ShareManager = require('../js/share').default\r\nconst get = require('simple-get')\r\nconst { getCurrentHost, startPlayer } = require('../js/gegeUtil')\r\nvar randombytes = require('randombytes')\r\n\r\nclass FileTransfer extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { resourceList: [], download: null, loadingMsg: '(下载中) ...', showqr: false, qrName: '' }\r\n        this.state.shareMsg = '';\r\n        this.share = new ShareManager(this.state);\r\n        /*\r\n        this.userSec = window.sessionStorage.getItem(\"userSec\");\r\n        if (!this.userSec) {\r\n          this.userSec = window.localStorage.getItem(\"userSec\");\r\n        }\r\n        */\r\n        this.tags = ''\r\n        this.resName = ''\r\n        this.resId = ''\r\n        this.infoInterval = null\r\n        this.torrentList = []\r\n    }\r\n\r\n    componentDidMount() {\r\n\r\n        let hash = window.location.hash;\r\n        let query = null;\r\n        let name = null;\r\n        if (hash) {\r\n            let idx = hash.indexOf(\"#\", 1);\r\n            if (idx > 0) {\r\n                //\r\n                query = hash.substr(idx + 1, 64);\r\n                let idx2 = hash.indexOf(\"#\", idx + 64); {\r\n                    if (idx2 > 0) {\r\n                        name = hash.substr(idx2 + 1);\r\n                    }\r\n                }\r\n                // console.log('query=' + query + \" name=\" + name);\r\n                if (query && query.length == 64) {\r\n                    if (name) {\r\n                        //name = Url.decode(name);\r\n                        this.setState({ download: name })\r\n                    } else {\r\n                        this.setState({ download: query })\r\n                    }\r\n                    this.startDownload(null, query);\r\n                }\r\n            }\r\n        }\r\n        this.share.init(this.onTorrentDone.bind(this), this.onTorrentStart.bind(this))\r\n    }\r\n\r\n    startDownload(secret, resId) {\r\n        var url = getShareHost() + \"/btb?action=p2pTransfer&resId=\" + resId;\r\n\r\n        get.concat({ url: url, json: true }, (function (err, r, data) {\r\n            if (err) {\r\n                //console.log(err);\r\n                this.setState({ shareMsg: 'err.出错了' });\r\n                return;\r\n            }\r\n            if (data.ok) {\r\n                //ok to play\r\n                let pid = '1234567890' + randombytes(15).toString('hex')\r\n                startPlayer(secret, { id: resId, tags: '' });\r\n            } else {\r\n                this.setState({ shareMsg: '不是免费资源' });\r\n            }\r\n        }).bind(this))\r\n    }\r\n\r\n    prettyBytes(num) {\r\n        var exponent, unit, neg = num < 0, units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n        if (neg) num = -num\r\n        if (num < 1) return (neg ? '-' : '') + num + ' B'\r\n        exponent = Math.min(Math.floor(Math.log(num) / Math.log(1000)), units.length - 1)\r\n        num = Number((num / Math.pow(1000, exponent)).toFixed(2))\r\n        unit = units[exponent]\r\n        return (neg ? '-' : '') + num + ' ' + unit\r\n    }\r\n\r\n    updateTorrentStatus() {\r\n        //console.log('size ' + this.torrentList.length)\r\n        this.torrentList.map((torrent) => {\r\n            //uploadSpeed peers\r\n            let peersSpan = document.querySelector('#pid' + torrent.infoHash);\r\n            let speedSpan = document.querySelector('#sid' + torrent.infoHash);\r\n            if (peersSpan)\r\n                peersSpan.innerHTML = torrent.numPeers;\r\n            if (speedSpan)\r\n                speedSpan.innerHTML = this.prettyBytes(torrent.uploadSpeed) + '/s';\r\n        })\r\n    }\r\n\r\n    onTorrentStart() {\r\n        this.setState({ shareMsg: '处理中...' })\r\n    }\r\n\r\n    onTorrentDone(torrent) {\r\n        if (torrent) {\r\n            var info = 'Torrent info hash: ' + torrent.infoHash +\r\n                'magnetURI=' + torrent.magnetURI +\r\n                ' torrentFileBlobURL=\"' + torrent.torrentFileBlobURL + 'name=' + torrent.name;\r\n            //console.log(info);\r\n            this.resId = torrent.infoHash\r\n            this.resName = torrent.name;\r\n            var rlist = this.state.resourceList;\r\n            rlist.push({ id: this.resId, name: this.resName })\r\n            this.setState({ resourceList: rlist })\r\n            torrent.key = torrent.infoHash;\r\n            //tags is not set yet\r\n            //torrent.tags = this.tags;\r\n            this.torrentList.unshift(torrent)\r\n        }\r\n        if (!this.infoInterval) {\r\n            this.infoInterval = setInterval(this.updateTorrentStatus.bind(this), 3000);\r\n        }\r\n        this.setState({ shareMsg: '' })\r\n    }\r\n\r\n\r\n    renderAddFile() {\r\n        return (<Row>\r\n            <Col xs=\"12\">\r\n                <Fade>\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <i className=\"icon-share\">点对点文件传输</i>\r\n                            <div className=\"card-header-actions\">\r\n                                <Button color=\"link\" className=\"card-header-action btn-setting\"><i className=\"icon-settings\"></i></Button>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <Collapse isOpen={true} id=\"collapseExample\">\r\n                            <CardBody>\r\n                                <div>\r\n                                    <p>选择要传输的文件,直接发送给好友，支持手机与电脑之间高速文件传输.</p>\r\n                                </div>\r\n                                <FormGroup>\r\n                                    <div className=\"controls\">\r\n                                        <InputGroup className=\"input-prepend\">\r\n                                            <InputGroupAddon addonType=\"prepend\">\r\n                                                <InputGroupText>Resource(资源):</InputGroupText>\r\n                                            </InputGroupAddon>\r\n                                            <input name=\"upload\" type=\"file\"></input>\r\n                                        </InputGroup>\r\n                                    </div>\r\n                                </FormGroup>\r\n                                <div>\r\n                                    <p><Alert color=\"danger\"><small>{this.state.shareMsg}</small></Alert></p>\r\n                                </div>\r\n                            </CardBody>\r\n                        </Collapse>\r\n                    </Card>\r\n                </Fade>\r\n            </Col>\r\n        </Row>)\r\n    }\r\n\r\n    showBarcode(resId, resName) {\r\n        this.setState({ showqr: true, qrName: resName });\r\n        var url = getCurrentHost() + \"/#/fly#\" + resId + '#' + resName;\r\n        setTimeout(() => {\r\n            showQRDialog(url);\r\n        }, 1500);\r\n    }\r\n\r\n    copyAddress(resid) {\r\n        let addr = document.querySelector('#url_' + resid);\r\n        addr.focus()\r\n        addr.select()\r\n        var successful = document.execCommand('copy');\r\n        let msg = document.querySelector('#msg_' + resid);\r\n        if (successful) {\r\n            msg.innerHTML = 'OK.复制成功'\r\n        } else {\r\n            msg.innerHTML = '复制失败，请手动复制'\r\n        }\r\n    }\r\n\r\n    renderResourceItems() {\r\n        let items = this.state.resourceList.map((res) => {\r\n            let pid = 'pid' + res.id;\r\n            let sid = 'sid' + res.id;\r\n            return (<ListGroupItem key={res.id} action>\r\n                <ListGroupItemHeading> <i className=\"fa fa-barcode\" onClick={(e) => this.showBarcode(res.id, res.name)}></i><span> {res.name} : 请将下面地址发给好友下载</span>\r\n                    <Button color=\"ghost-success\" onClick={(e) => this.copyAddress(res.id)}>\r\n                        <i className=\"fa fa-copy fa-lg\"></i>&nbsp;复制地址\r\n        </Button>\r\n                    <span className='alert-primary' id={'msg_' + res.id}></span>\r\n                </ListGroupItemHeading>\r\n                <ListGroupItemHeading><input readOnly style={{ width: '100%' }} id={'url_' + res.id} value={getCurrentHost() + \"/#/fly#\" + res.id + '#' + res.name}></input></ListGroupItemHeading>\r\n                <ListGroupItemText>\r\n                    <code> <span id={pid}></span>节点</code>. &#x2197;<code><span id={sid}></span>上传速度</code>\r\n                </ListGroupItemText>\r\n            </ListGroupItem>)\r\n        })\r\n        return items;\r\n    }\r\n\r\n    toggle() {\r\n        this.setState({ showqr: !this.state.showqr })\r\n    }\r\n\r\n    renderShareList() {\r\n        return (<Row>\r\n            <Col sm=\"12\" xl=\"6\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        <i className=\"fa fa-align-justify\"></i><strong>Transfer List(传输列表</strong>\r\n                        <Alert color=\"danger\"><small>资源不会上传给任何服务器，点对点直接从本地下载。Please keep this page open.请不要刷新或关闭此页面，保持此页面打开状态下，文件传输才能正常工作。页面异常情况可以重新选择文件继续传输。</small></Alert>\r\n                    </CardHeader>\r\n                    <CardBody>\r\n                        <ListGroup>\r\n                            {this.renderResourceItems()}\r\n                        </ListGroup>\r\n                        <Modal isOpen={this.state.showqr} className={this.props.className}>\r\n                            <ModalHeader toggle={this.toggle.bind(this)}>{this.state.qrName}</ModalHeader>\r\n                            <ModalBody>\r\n                                <div id=\"qrcode\"></div>\r\n                            </ModalBody>\r\n                        </Modal>\r\n                    </CardBody>\r\n                </Card>\r\n            </Col>\r\n        </Row>)\r\n    }\r\n\r\n    renderPlayer() {\r\n        if (!this.state.download)\r\n            return null;\r\n        return (\r\n            <div id=\"playdiv\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        {this.state.download}\r\n                        <Badge color=\"success\" className=\"float-right\">{this.state.loadingMsg}</Badge>\r\n                    </CardHeader>\r\n                    <CardBody>\r\n                        <div id=\"status\">\r\n                            <div>\r\n                                <span className=\"show-leech\"> from </span>\r\n                                <code id=\"numPeers\">0 peers</code>.\r\n                            <code id=\"downloadSpeed\">0 b/s </code> / &#x2197;\r\n                            <code id=\"uploadSpeed\">0 b/s - </code>\r\n                                <code id=\"downloaded\"></code> of\r\n                            <code id=\"total\"></code> —\r\n                            <span id=\"remaining\"></span>\r\n                            </div>\r\n                        </div>\r\n                        <div id=\"player\" style={{ width: '100%' }}>\r\n                        </div>\r\n                    </CardBody>\r\n                </Card>\r\n\r\n            </div>\r\n        )\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"animated fadeIn\">\r\n                {this.renderPlayer()}\r\n                {this.renderAddFile()}\r\n                {this.renderShareList()}\r\n\r\n            </div>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nexport default FileTransfer;\r\n"],"sourceRoot":""}