{"version":3,"sources":["views/ggv/HongbaoWeb/HongbaoWeb.js"],"names":["randombytes","require","HongbaoWeb","props","_this","Object","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","E_working_dir_flycat_flycat_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","page","state","list","count","paying","fee","deadline","_this2","account","loadLocalAccount","secret","setState","hash","window","location","query","title","idx","indexOf","substr","decodeURIComponent","loadHongbaoInfo","setTimeout","peerId","isTempPeerId","createTempPeerId","loadIframe","iframe","bind","_this3","data","action","bshopCall","ok","hb","hongbao","joins","content","newsId","document","querySelector","url","getFileHost","innerHTML","pid","startsWith","toString","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","reactstrap__WEBPACK_IMPORTED_MODULE_11__","color","href","id","style","width","records","map","r","d","Date","setTime","time","btime","toLocaleString","_conponents_AccountDialog__WEBPACK_IMPORTED_MODULE_18__","rsId","senderId","amount","reactstrap__WEBPACK_IMPORTED_MODULE_7__","hover","bordered","striped","responsive","size","reactstrap__WEBPACK_IMPORTED_MODULE_8__","reactstrap__WEBPACK_IMPORTED_MODULE_9__","reactstrap__WEBPACK_IMPORTED_MODULE_10__","renderPayButton","renderPlayer","renderIframe","renderHongbaoJoins","Component"],"mappings":"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","file":"static/js/20.c1ec8deb.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { Badge, Card, CardBody, CardHeader, Col, Pagination, PaginationItem, PaginationLink, Row, Table } from 'reactstrap';\r\nimport { Popover, PopoverBody, PopoverHeader, Alert, Button } from 'reactstrap';\r\nimport { Modal, ModalBody, ModalFooter, ModalHeader, Label, Input, InputGroup, InputGroupAddon, InputGroupText, FormGroup } from 'reactstrap'\r\nimport { loadLocalAccount, getCurrentHost,getFileHost } from '../js/gegeUtil.js'\r\nimport PopHint from '../../conponents/PopHint/PopHint'\r\nimport { bshopCall} from '../../eshop/eshop'\r\nimport AccountDialog from '../../conponents/AccountDialog'\r\nconst get = require('simple-get')\r\nconst randombytes = require('randombytes')\r\n\r\nclass HongbaoWeb extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.page = 1;\r\n    this.state = { list: [], page: 1, count: 0, paying: false, fee: '1', deadline: '5' }\r\n  }\r\n\r\n  componentDidMount() {\r\n    var account = loadLocalAccount();\r\n    if (account && account.secret)\r\n      this.secret = account.secret;\r\n    this.setState({ account })\r\n    let hash = window.location.hash;\r\n    let query = null;\r\n    let title = null;\r\n    if (hash) {\r\n      let idx = hash.indexOf(\"#\", 1);\r\n      if (idx > 0) {\r\n        hash = hash.substr(idx)\r\n        idx = hash.indexOf(\"#\", 1);\r\n        if (idx > 1) {\r\n          title = hash.substr(idx);\r\n          title = decodeURIComponent(title)\r\n          if (title) {\r\n            this.setState({ title })\r\n          }\r\n          query = hash.substr(1, (idx-1 ));\r\n        }else{\r\n          query = hash.substr(1);\r\n        }\r\n        //console.log('query=' + query);\r\n      }\r\n      //\r\n      this.loadHongbaoInfo(query)\r\n    }\r\n    setTimeout((() => {\r\n      let peerId = null;\r\n      if (!peerId && this.state.account)\r\n        peerId = this.state.account.peerId\r\n      if (!peerId) {\r\n        peerId = this.createTempPeerId();\r\n        this.setState({ peerId })\r\n      } else {\r\n        if (this.isTempPeerId(peerId)) {\r\n          this.setState({ peerId: null })\r\n        }\r\n      }\r\n      let iframeTime = setTimeout(() => {\r\n        //load iframe\r\n        this.loadIframe(peerId, query)\r\n        this.setState({ iframe: true })\r\n      }, 1000);\r\n     \r\n    }).bind(this), 500);\r\n    //\r\n    //this.doTest()\r\n  }\r\n\r\n  loadHongbaoInfo(hash){\r\n      let data = { action: 'hongbao', hash}\r\n      bshopCall(data, ((ok, hb) => {\r\n        if (ok && hb) {\r\n          let hongbao = {};\r\n          hongbao.joins = hb.list;\r\n          hongbao.content = hb.content;\r\n          this.setState({ hongbao })\r\n        }\r\n      }).bind(this))\r\n  }\r\n\r\n  loadIframe(peerId, newsId) {\r\n    var page = document.querySelector('#iframe')\r\n    var url = getFileHost() + '/html/' + peerId + '/' + newsId;\r\n    page.innerHTML = \"<iframe width='100%' height='500px' frameborder='0' name='_blank' src='\" + url + \"' />\"\r\n  }\r\n\r\n  isTempPeerId(pid) {\r\n    return pid && pid.startsWith('0000');\r\n  }\r\n\r\n  createTempPeerId() {\r\n    let pid = '0000' + randombytes(18).toString('hex')\r\n    return pid;\r\n  }\r\n\r\n  togglePurchase() {\r\n    this.setState({ paying: !this.state.paying })\r\n  }\r\n\r\n  doPurchase() {\r\n\r\n  }\r\n\r\n\r\n  renderPayButton() {\r\n    return (<Alert color=\"primary\">请下载眞客安卓客户端领取现金红包,<a href='https://github.com/btbresource/btb-android'>点击下载安卓客户端</a> </Alert>)\r\n  }\r\n\r\n  renderIframe() {\r\n    return (<div id=\"iframe\" style={{ width: '100%' }}>\r\n    </div>)\r\n  }\r\n\r\n  renderPlayer() {\r\n    if (this.state.iframe)\r\n      return null;\r\n    return (<div>\r\n      <div id=\"status\">\r\n        <div>\r\n          <code id=\"numPeers\">0 peers(节点</code>.\r\n                          <code id=\"downloadSpeed\">0 b/s </code> / &#x2197;\r\n                          <code id=\"uploadSpeed\">0 b/s - </code>\r\n          <code id=\"downloaded\"></code> of\r\n                          <code id=\"total\"></code> —\r\n                          <span id=\"remaining\"></span>\r\n        </div>\r\n      </div>\r\n      <div id=\"player\" style={{ width: '100%' }}>\r\n      </div>\r\n    </div>)\r\n  }\r\n\r\n  renderHongbaoJoins() {\r\n    if (!this.state.hongbao || !this.state.hongbao.joins)\r\n      return null;\r\n    let records = this.state.hongbao.joins.map((r) => {\r\n      let d = new Date();\r\n      d.setTime(r.time)\r\n      let btime = d.toLocaleString()\r\n      return (<tr>\r\n        <td><AccountDialog rsId={r.senderId} /></td>\r\n        <td>{r.amount}积分现金</td>\r\n        <td>{btime}</td>\r\n      </tr>)\r\n    })\r\n    return (<Table hover bordered striped responsive size=\"sm\">\r\n      <thead>\r\n        <tr>\r\n          <th>账户</th>\r\n          <th>领取红包</th>\r\n          <th>时间</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {records}\r\n      </tbody>\r\n    </Table>)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"playdiv\">\r\n        <Card>\r\n          <CardHeader>\r\n            {this.state.title}\r\n          </CardHeader>\r\n          <CardBody>\r\n            {this.renderPayButton()}\r\n            {this.renderPlayer()}\r\n            {this.renderIframe()}\r\n            {this.renderHongbaoJoins()}\r\n          </CardBody>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass PopoverItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.toggle = this.toggle.bind(this);\r\n    this.state = {\r\n      popoverOpen: false\r\n    };\r\n  }\r\n\r\n  toggle() {\r\n    this.setState({\r\n      popoverOpen: !this.state.popoverOpen,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <span>\r\n        <span className='alert-primary  fade show' id={'Popover-' + this.props.id} onClick={this.toggle}>\r\n          (分享链接)\r\n        </span>\r\n        <Popover placement='top' isOpen={this.state.popoverOpen} target={'Popover-' + this.props.id} toggle={this.toggle}>\r\n          <PopoverHeader>分享这个资源的链接</PopoverHeader>\r\n          <PopoverBody>{getCurrentHost() + \"/#/btb#\" + this.props.res.id}</PopoverBody>\r\n        </Popover>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HongbaoWeb;\r\n"],"sourceRoot":""}